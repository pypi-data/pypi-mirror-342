{% macro bar_chart(container_id, title="", x_data=[], y_data=[], orientation="v", x_title="", y_title="", height="400px") %}
<div class="chart-container">
    {% if title %}<h3 class="chart-title">{{ title }}</h3>{% endif %}
    <div id="{{ container_id }}" style="height: {{ height }};"></div>
    <script>
        function render{{ container_id|replace('-', '_') }}BarChart() {
            if (typeof Plotly === 'undefined') {
                console.error('Plotly not loaded for {{ container_id }}');
                return;
            }

            const trace = {
                x: {{ x_data|tojson }},
                y: {{ y_data|tojson }},
                type: 'bar',
                orientation: '{{ orientation }}',
                marker: {
                    color: '{{ orientation }}' === 'h' ? 
                        {{ y_data|tojson }}.map(val => `rgba(27, 120, 222, ${0.4 + (val/Math.max(...{{ y_data|tojson }})) * 0.6})`) :
                        {{ x_data|tojson }}.map(val => `rgba(27, 120, 222, ${0.4 + (val/Math.max(...{{ x_data|tojson }})) * 0.6})`)
                }
            };
            
            const layout = {
                margin: { t: 30, b: 50, l: 60, r: 30 },
                xaxis: { 
                    title: '{{ x_title }}',
                    automargin: true
                },
                yaxis: { 
                    title: '{{ y_title }}',
                    automargin: true
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(248,249,250,0.5)'
            };
            
            const config = {
                responsive: true
            };
            
            try {
                Plotly.newPlot('{{ container_id }}', [trace], layout, config);
                console.log('Bar chart rendered successfully:', '{{ container_id }}');
                if (window.debugDeepBridge) {
                    window.debugDeepBridge.logEvent('BarChartRendered', '{{ container_id }}');
                }
            } catch (error) {
                console.error('Error rendering bar chart:', error);
                if (window.debugDeepBridge) {
                    window.debugDeepBridge.logEvent('BarChartError', {
                        id: '{{ container_id }}',
                        error: error.message
                    });
                }
            }
        }

        // Listen for both events
        document.addEventListener('DOMContentLoaded', render{{ container_id|replace('-', '_') }}BarChart);
        document.addEventListener('renderCharts', render{{ container_id|replace('-', '_') }}BarChart);
    </script>
</div>
{% endmacro %}

<style>
    .chart-container {
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        margin-bottom: 30px;
    }
    
    .chart-title {
        text-align: center;
        margin-top: 0;
        margin-bottom: 15px;
        color: #333;
        font-size: 18px;
    }
</style>