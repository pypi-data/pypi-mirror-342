<!-- 
   Simple Subtabs Component
   Usage:
   1. Include this file in your template
   2. Use the component by creating subtabs navigation div with class .subtabs and data-parent attribute
   3. Create subtab-content divs with matching data-parent attribute and ids referenced by data-subtab 
-->

<style>
.subtabs-container {
    margin-bottom: 20px;
}

.subtabs {
    display: flex;
    background-color: #f0f2f4;
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid #e1e4e8;
    margin-bottom: 15px;
}

.subtab {
    padding: 8px 16px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: #555;
    border-right: 1px solid #e1e4e8;
    transition: background-color 0.2s;
}

.subtab:last-child {
    border-right: none;
}

.subtab:hover {
    background-color: #e9ecef;
}

.subtab.active {
    background-color: #1b78de;
    color: white;
}

.subtab-content {
    display: none;
    padding: 15px;
    background-color: #ffffff;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    border: 1px solid #e1e4e8;
}

.subtab-content.active {
    display: block;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeSubtabs();
});

document.addEventListener('renderCharts', function() {
    initializeSubtabs();
});

function initializeSubtabs() {
    console.log("Initializing subtabs");
    const subtabs = document.querySelectorAll('.subtab');
    
    if (window.debugDeepBridge) {
        window.debugDeepBridge.logEvent('InitializeSubtabs', {
            subtabCount: subtabs.length
        });
    }
    
    subtabs.forEach(subtab => {
        if (!subtab.hasSubtabListener) {
            subtab.addEventListener('click', function() {
                const parentId = this.getAttribute('data-parent');
                
                // Remove active class from all subtabs with the same parent
                const relatedSubtabs = document.querySelectorAll(`.subtab[data-parent="${parentId}"]`);
                relatedSubtabs.forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked subtab
                this.classList.add('active');
                
                // Hide all subtab content with the same parent
                const relatedContents = document.querySelectorAll(`.subtab-content[data-parent="${parentId}"]`);
                relatedContents.forEach(content => content.classList.remove('active'));
                
                // Show selected subtab content
                const targetId = this.getAttribute('data-subtab');
                const targetContent = document.getElementById(targetId);
                
                if (targetContent) {
                    targetContent.classList.add('active');
                    
                    // Trigger resize event for Plotly charts to fix layout issues
                    window.dispatchEvent(new Event('resize'));
                    
                    // Log the event if debugging is enabled
                    if (window.debugDeepBridge) {
                        window.debugDeepBridge.logEvent('SubtabClick', {
                            parentId: parentId,
                            targetId: targetId
                        });
                    }
                } else {
                    console.error(`Subtab content with ID "${targetId}" not found`);
                    if (window.debugDeepBridge) {
                        window.debugDeepBridge.logEvent('SubtabError', {
                            error: `Content with ID "${targetId}" not found`,
                            parentId: parentId,
                            targetId: targetId
                        });
                    }
                }
            });
            subtab.hasSubtabListener = true;
        }
    });
}
</script>