<!-- feature_filter.html - placeholder -->
<div class="feature-filter-widget" id="{{ id|default('feature-filter') }}">
    <div class="filter-header">
        <h4 class="filter-title">{{ title|default('Feature Filter') }}</h4>
        {% if collapsible %}
        <button class="filter-toggle" data-target="{{ id|default('feature-filter') }}-content">
            <span class="toggle-icon">▼</span>
        </button>
        {% endif %}
    </div>
    
    <div class="filter-content" id="{{ id|default('feature-filter') }}-content">
        <div class="filter-section">
            <div class="search-box">
                <input 
                    type="text" 
                    id="{{ id|default('feature-filter') }}-search" 
                    class="filter-search" 
                    placeholder="Search features..."
                    data-controller="{{ controller }}"
                >
                <button class="search-clear" id="{{ id|default('feature-filter') }}-search-clear">×</button>
            </div>
        </div>
        
        <div class="filter-section">
            <label class="filter-label">Show Features:</label>
            <div class="filter-options">
                <label class="filter-option">
                    <input 
                        type="radio" 
                        name="{{ id|default('feature-filter') }}-display" 
                        value="all" 
                        checked
                        data-controller="{{ controller }}"
                    >
                    <span>All Features</span>
                </label>
                <label class="filter-option">
                    <input 
                        type="radio" 
                        name="{{ id|default('feature-filter') }}-display" 
                        value="top"
                        data-controller="{{ controller }}"
                    >
                    <span>Top Features</span>
                </label>
                <label class="filter-option">
                    <input 
                        type="radio" 
                        name="{{ id|default('feature-filter') }}-display" 
                        value="subset"
                        data-controller="{{ controller }}"
                    >
                    <span>Optimal Subset</span>
                </label>
            </div>
        </div>
        
        <div class="filter-section top-features-options" style="display: none;">
            <label class="filter-label">Top Features Count:</label>
            <div class="range-selector">
                <input 
                    type="range" 
                    id="{{ id|default('feature-filter') }}-top-count" 
                    class="range-input"
                    min="5" 
                    max="50" 
                    step="5" 
                    value="15"
                    data-controller="{{ controller }}"
                >
                <span class="range-value" id="{{ id|default('feature-filter') }}-top-count-display">15</span>
            </div>
        </div>
        
        <div class="filter-section">
            <label class="filter-label">Importance Type:</label>
            <div class="filter-options">
                <label class="filter-option">
                    <input 
                        type="radio" 
                        name="{{ id|default('feature-filter') }}-importance" 
                        value="model"
                        data-controller="{{ controller }}"
                        {% if activeImportance == 'model' %}checked{% endif %}
                    >
                    <span>Model Importance</span>
                </label>
                <label class="filter-option">
                    <input 
                        type="radio" 
                        name="{{ id|default('feature-filter') }}-importance" 
                        value="robustness"
                        data-controller="{{ controller }}"
                        {% if activeImportance == 'robustness' %}checked{% endif %}
                    >
                    <span>Robustness Importance</span>
                </label>
                <label class="filter-option">
                    <input 
                        type="radio" 
                        name="{{ id|default('feature-filter') }}-importance" 
                        value="combined"
                        data-controller="{{ controller }}"
                        {% if activeImportance == 'combined' %}checked{% endif %}
                    >
                    <span>Combined</span>
                </label>
            </div>
        </div>
        
        {% if showApplyButton %}
        <div class="filter-actions">
            <button 
                class="apply-filter-btn" 
                id="{{ id|default('feature-filter') }}-apply"
                data-controller="{{ controller }}"
            >
                Apply Filter
            </button>
        </div>
        {% endif %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        initFeatureFilter('{{ id|default("feature-filter") }}', '{{ controller }}');
    });

    function initFeatureFilter(filterId, controllerName) {
        const filterWidget = document.getElementById(filterId);
        if (!filterWidget) return;
        
        // Handle collapsible functionality
        const toggleBtn = filterWidget.querySelector('.filter-toggle');
        if (toggleBtn) {
            const targetId = toggleBtn.getAttribute('data-target');
            const targetContent = document.getElementById(targetId);
            
            toggleBtn.addEventListener('click', function() {
                const icon = this.querySelector('.toggle-icon');
                if (targetContent.style.display === 'none') {
                    targetContent.style.display = 'block';
                    icon.textContent = '▼';
                } else {
                    targetContent.style.display = 'none';
                    icon.textContent = '►';
                }
            });
        }
        
        // Handle search clear button
        const searchInput = filterWidget.querySelector('.filter-search');
        const clearBtn = filterWidget.querySelector('.search-clear');
        if (searchInput && clearBtn) {
            clearBtn.addEventListener('click', function() {
                searchInput.value = '';
                searchInput.dispatchEvent(new Event('input'));
                
                // Call controller if defined
                if (controllerName && window[controllerName]) {
                    window[controllerName]('searchClear');
                }
            });
        }
        
        // Handle top features options visibility
        const displayOptions = filterWidget.querySelectorAll('input[name="' + filterId + '-display"]');
        const topFeaturesOptions = filterWidget.querySelector('.top-features-options');
        
        displayOptions.forEach(option => {
            option.addEventListener('change', function() {
                if (this.value === 'top') {
                    topFeaturesOptions.style.display = 'block';
                } else {
                    topFeaturesOptions.style.display = 'none';
                }
                
                // Call controller if defined
                if (controllerName && window[controllerName]) {
                    window[controllerName]('displayChange', this.value);
                }
            });
        });
        
        // Handle range input display
        const rangeInput = filterWidget.querySelector('.range-input');
        const rangeDisplay = filterWidget.querySelector('.range-value');
        
        if (rangeInput && rangeDisplay) {
            rangeInput.addEventListener('input', function() {
                rangeDisplay.textContent = this.value;
                
                // Call controller if defined
                if (controllerName && window[controllerName]) {
                    window[controllerName]('rangeChange', this.value);
                }
            });
        }
        
        // Handle importance type change
        const importanceOptions = filterWidget.querySelectorAll('input[name="' + filterId + '-importance"]');
        
        importanceOptions.forEach(option => {
            option.addEventListener('change', function() {
                // Call controller if defined
                if (controllerName && window[controllerName]) {
                    window[controllerName]('importanceChange', this.value);
                }
            });
        });
        
        // Handle apply button if present
        const applyBtn = filterWidget.querySelector('.apply-filter-btn');
        if (applyBtn) {
            applyBtn.addEventListener('click', function() {
                // Collect all filter settings
                const settings = {
                    search: searchInput ? searchInput.value : '',
                    display: filterWidget.querySelector('input[name="' + filterId + '-display"]:checked').value,
                    topCount: rangeInput ? rangeInput.value : 15,
                    importance: filterWidget.querySelector('input[name="' + filterId + '-importance"]:checked').value
                };
                
                // Call controller if defined
                if (controllerName && window[controllerName]) {
                    window[controllerName]('applyFilters', settings);
                }
            });
        }
    }
</script>