<!-- index.html - placeholder -->
<!-- index.html - Main entry point for the resilience report -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepBridge Resilience Report</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/png;base64, {{ favicon }}" type="image/png">
    
    <!-- Base CSS -->
    <style>
        :root {
            --primary-color: #1b78de;  /* Bright blue */
            --secondary-color: #2c3e50; /* Dark blue/slate */
            --background-color: #f8f9fa;
            --text-color: #333;
            --border-color: #ddd;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --card-bg: #ffffff;
            --hover-bg: #f5f7fa;
        }
        
        /* Base styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
        }
        
        h1, h2, h3, h4, h5, h6 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-weight: 500;
            line-height: 1.2;
        }
        
        p {
            margin-top: 0;
            margin-bottom: 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(to right, #1a5fb4, #3584e4, #62a0ea);
            color: white;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 20px;
        }
        
        footer {
            background-color: var(--secondary-color);
            color: white;
            padding: 1rem;
            text-align: center;
            margin-top: 2rem;
        }
        
        /* Header specific styles */
        .header-container {
            display: flex;
            align-items: center;
            width: 100%;
        }
        
        .logo-container {
            flex: 0 0 150px;
            padding-right: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo {
            max-width: 120px;
            height: auto;
            max-height: 60px;
            object-fit: contain;
        }
        
        .title-container {
            flex: 1;
            text-align: left;
        }
        
        .title-container h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .report-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            font-size: 14px;
            color: #e0e0e0;
        }
        
        .info-item {
            display: inline-block;
        }
        
        /* Footer styles */
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn-print {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Additional common styles */
        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 25px;
            margin-bottom: 25px;
        }
        
        /* Tab styles */
        .main-tabs {
            display: flex;
            overflow-x: auto;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
            background-color: var(--card-bg);
            border-radius: 8px 8px 0 0;
            padding: 0 15px;
        }
        
        .tab-btn {
            padding: 12px 25px;
            margin: 0 5px;
            cursor: pointer;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #666;
            transition: all 0.2s ease;
        }
        
        .tab-btn:hover {
            background-color: var(--hover-bg);
        }
        
        .tab-btn.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }
        
        .tab-content {
            display: none;
            background-color: var(--card-bg);
            border-radius: 0 0 8px 8px;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Resilience report specific styles */
        .resilience-report {
            padding: 15px 0;
        }
        
        .report-header {
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            flex-direction: row;
            gap: 30px;
        }
        
        .header-info {
            flex: 2;
        }
        
        .header-metrics {
            flex: 1;
            min-width: 250px;
            border-left: 1px solid #eee;
            padding-left: 30px;
        }
        
        /* Button styles */
        button {
            cursor: pointer;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            background-color: #f0f0f0;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #e0e0e0;
        }
        
        .action-button {
            background-color: var(--primary-color);
            color: white;
        }
        
        .action-button:hover {
            background-color: #1666c0;
        }
    </style>

    <title>DeepBridge Resilience Report</title>
    <!-- No external stylesheets, all styles are embedded directly -->
    
    <!-- Embedded styles for report components -->
    <style>
        /* Metric styling */
        .metric-value { 
            font-size: 1.5em; 
            font-weight: bold; 
            line-height: 1.4;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .excellent { color: #28a745; } 
        .good { color: #17a2b8; } 
        .moderate { color: #fd7e14; }
        .fair { color: #ffc107; } 
        .poor { color: #dc3545; } 
        .neutral { color: #6c757d; }
        
        /* Chart styling */
        .chart-container { 
            min-height: 300px; 
            padding: 20px; 
            border: 1px solid #eee; 
            border-radius: 8px; 
            background: white;
            margin-bottom: 25px;
        }
        
        .chart-container:not(.active) { 
            display: none; 
        }
        
        .chart-title { 
            text-align: center; 
            margin-bottom: 20px; 
            font-weight: 600;
            font-size: 18px;
            color: #333;
        }
        
        .chart-placeholder { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 220px; 
            background: #f9f9f9; 
            border-radius: 6px; 
            color: #777; 
            font-style: italic;
            border: 1px dashed #ddd;
        }
        
        /* Chart selectors */
        .chart-selector { 
            margin-bottom: 20px; 
            background: white;
            padding: 15px;
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid #eee;
        }
        
        .chart-options { 
            display: flex; 
            gap: 12px; 
        }
        
        .chart-option { 
            padding: 10px 15px; 
            background: #f7f7f7; 
            border: 1px solid #e0e0e0; 
            border-radius: 4px; 
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .chart-option:hover {
            background: #eff6ff;
            border-color: #cde0fd;
        }
        
        .chart-option.active { 
            background: #e3f2fd; 
            border-color: #2196f3; 
            color: #0d47a1;
            box-shadow: 0 2px 4px rgba(33, 150, 243, 0.1);
        }
        
        /* Results tables */
        .results-tables-section { 
            margin-top: 30px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .results-tables-section h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .tab-navigation { 
            margin-bottom: 20px; 
        }
        
        .tab-buttons { 
            display: flex; 
            gap: 12px;
            border-bottom: 1px solid #eee;
            padding-bottom: 12px;
        }
        
        /* Table styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: white;
        }
        
        table th {
            background: #f5f7fa;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
        }
        
        table td {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        
        table tr:last-child td {
            border-bottom: none;
        }
        
        table tr:hover {
            background: #f9f9f9;
        }
        
        /* Insight cards */
        .insights-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 25px; 
            margin-top: 25px; 
        }
        
        .insight-card { 
            background: white; 
            border-radius: 10px; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.06); 
            padding: 20px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .insight-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .insight-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .insight-header h5 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .insight-icon {
            font-size: 20px;
            color: var(--primary-color);
            background: #f0f7ff;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .insight-content p { 
            margin-top: 0;
            margin-bottom: 15px;
            color: #555;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .insight-metric { 
            margin-top: 15px; 
            display: flex; 
            justify-content: space-between;
            align-items: center;
            background: #f9f9f9;
            padding: 10px 15px;
            border-radius: 5px;
        }
        
        .insight-metric .metric-label {
            font-weight: 600;
            color: #444;
        }
        
        /* Summary sections */
        .overview-summary {
            margin-bottom: 30px;
        }
        
        .summary-overview { 
            background: white; 
            border-radius: 10px; 
            padding: 25px; 
            margin-bottom: 25px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.06); 
        }
        
        .overview-header {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .overview-description p {
            color: #555;
            font-size: 15px;
            line-height: 1.6;
        }
        
        .key-findings {
            margin-top: 25px;
        }
        
        .findings-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .finding-item { 
            display: flex; 
            margin-bottom: 20px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            align-items: center;
        }
        
        .finding-icon {
            margin-right: 15px;
            font-size: 20px;
            color: var(--primary-color);
            background: #e6f0fd;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .finding-content {
            flex: 1;
        }
        
        .finding-label { 
            font-weight: 600; 
            margin-bottom: 5px;
            display: block;
            color: #444;
        }
        
        .finding-value {
            font-size: 16px;
            font-weight: 500;
        }
        
        /* Recommendations section */
        .recommendations {
            margin-top: 30px;
        }
        
        .recommendations-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .recommendation-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .recommendation-item {
            background: #f0f7ff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            font-size: 14px;
            line-height: 1.5;
            color: #333;
        }
        
        /* No data message */
        .no-data-message { 
            padding: 20px; 
            text-align: center; 
            background: #f9f9f9; 
            color: #777; 
            font-style: italic; 
            border-radius: 8px;
            border: 1px dashed #ddd;
            margin: 15px 0;
        }
        
        /* Shift scenarios dialog */
        .shift-scenarios-list {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.15);
            padding: 20px;
            max-width: 90%;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .shift-scenarios-list:not(.hidden) {
            display: block;
        }
        
        .hidden {
            display: none;
        }
        
        .shift-scenarios-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .shift-scenarios-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }
        
        .shift-scenarios-toggle {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        /* Gap classes for metrics tables */
        .minor-gap {
            background-color: rgba(40, 167, 69, 0.15);
            color: #155724;
            font-weight: bold;
        }
        
        .moderate-gap {
            background-color: rgba(255, 193, 7, 0.15);
            color: #856404;
            font-weight: bold;
        }
        
        .significant-gap {
            background-color: rgba(253, 126, 20, 0.15);
            color: #c66a10;
            font-weight: bold;
        }
        
        .severe-gap {
            background-color: rgba(220, 53, 69, 0.15);
            color: #721c24;
            font-weight: bold;
        }
        
        /* Metrics table specific styles */
        .metrics-details-table th {
            text-align: center;
            vertical-align: middle;
        }
        
        .metrics-details-table .scenario-col {
            min-width: 150px;
            font-weight: 600;
        }
        
        .metrics-details-table .baseline-col,
        .metrics-details-table .target-col,
        .metrics-details-table .gap-col {
            text-align: center;
            min-width: 80px;
        }
        
        .metrics-details-table .composite-col {
            text-align: center;
            font-weight: 600;
            min-width: 100px;
        }
        
        .metrics-summary-table td {
            text-align: center;
        }
        
        .metrics-summary-table .metric-col {
            text-align: left;
            font-weight: 600;
        }
        
        .no-data-message {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }
            
            .header-metrics {
                border-left: none;
                padding-left: 0;
                border-top: 1px solid #eee;
                padding-top: 20px;
                margin-top: 20px;
            }
            
            .insights-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-options {
                flex-wrap: wrap;
            }
        }
    </style>
    
    <!-- Additional component styles -->
    <style>
        /* Resilience score component styling */
        .resilience-score-indicator {
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }
        
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #f0f7ff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            position: relative;
            border: 4px solid var(--primary-color);
        }
        
        .score-inner {
            text-align: center;
        }
        
        .score-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .score-label {
            font-size: 14px;
            color: #555;
            font-weight: 500;
        }
        
        .score-description {
            text-align: center;
            margin: 15px 0;
        }
        
        .score-text {
            font-size: 15px;
            line-height: 1.5;
            color: #444;
            margin: 0;
        }
        
        .score-interpretation {
            margin-top: 20px;
        }
        
        .interpretation-scale {
            display: flex;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .scale-segment {
            flex: 1;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            padding: 5px 0;
            position: relative;
        }
        
        .scale-segment::before {
            content: '';
            position: absolute;
            bottom: 25px;
            left: 0;
            right: 0;
            height: 8px;
        }
        
        .poor::before { background-color: #dc3545; }
        .fair::before { background-color: #ffc107; }
        .moderate::before { background-color: #fd7e14; }
        .good::before { background-color: #17a2b8; }
        .excellent::before { background-color: #28a745; }
        
        .scale-indicator {
            position: absolute;
            bottom: 0;
            width: 10px;
            height: 10px;
            background: #333;
            border-radius: 50%;
            transform: translateX(-50%);
            z-index: 2;
        }
        
        .scale-description {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-top: 25px;
        }
    </style>
    
    <!-- Load Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
    
    <!-- Script for basic interactivity -->
    <script>
        // This script adds interactivity to the report components
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize shift scenarios dialog
            const scenarioToggleBtn = document.querySelector('.shift-scenarios-toggle');
            const scenariosDialog = document.getElementById('shift-scenarios-list');
            const closeDialogBtn = document.querySelector('.shift-scenarios-close');
            
            if (scenarioToggleBtn && scenariosDialog) {
                scenarioToggleBtn.addEventListener('click', function() {
                    scenariosDialog.classList.remove('hidden');
                });
                
                if (closeDialogBtn) {
                    closeDialogBtn.addEventListener('click', function() {
                        scenariosDialog.classList.add('hidden');
                    });
                }
                
                // Close when clicking outside
                document.addEventListener('click', function(event) {
                    if (!scenariosDialog.contains(event.target) && 
                        !scenarioToggleBtn.contains(event.target) && 
                        !scenariosDialog.classList.contains('hidden')) {
                        scenariosDialog.classList.add('hidden');
                    }
                });
            }
            
            // Hide placeholders when charts are created
            document.querySelectorAll('.chart-container').forEach(function(container) {
                const placeholder = container.querySelector('.chart-placeholder');
                if (placeholder) {
                    // We'll manually hide placeholders when charts are created
                    console.log('Found placeholder in container:', container.id);
                }
            });
            
            // Format JSON in shift-scenarios-list if present
            const scenariosList = document.querySelector('.scenario-list');
            if (scenariosList && scenariosList.textContent.trim().startsWith('[')) {
                try {
                    const jsonContent = JSON.parse(scenariosList.textContent.trim());
                    let formattedHtml = '';
                    
                    jsonContent.forEach((scenario, index) => {
                        formattedHtml += `<li class="scenario-item">
                            <div class="scenario-number">#${index + 1}</div>
                            <div class="scenario-details">
                                <span class="scenario-alpha">Alpha: ${scenario.alpha * 100}%</span>
                                <span class="scenario-metric">Metric: ${scenario.metric}</span>
                                <span class="scenario-distance">Distance: ${scenario.distance_metric}</span>
                                <span class="scenario-gap">Performance Gap: ${(scenario.performance_gap * 100).toFixed(2)}%</span>
                            </div>
                        </li>`;
                    });
                    
                    scenariosList.innerHTML = formattedHtml;
                } catch (e) {
                    console.error('Error formatting scenarios JSON:', e);
                }
            }
        });
        
        // Fallback function to handle tab navigation
        document.addEventListener('DOMContentLoaded', function() {
            // Basic tab navigation
            const tabButtons = document.querySelectorAll('.main-tabs .tab-btn');
            const tabContainers = document.querySelectorAll('.tab-content');
            
            if (tabButtons && tabContainers) {
                tabButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');
                        
                        // Update active tab button
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Update visible tab content
                        tabContainers.forEach(container => {
                            if (container.id === tabId) {
                                container.classList.add('active');
                            } else {
                                container.classList.remove('active');
                            }
                        });
                    });
                });
            }
            
            // Log error if main scripts failed to load
            window.addEventListener('error', function(e) {
                if (e.target.tagName === 'SCRIPT') {
                    console.warn('Script loading error:', e.target.src);
                }
            }, true);
            
            // Add debug UI for development
            function addDebugPanel() {
                const debugPanel = document.createElement('div');
                debugPanel.style.position = 'fixed';
                debugPanel.style.bottom = '10px';
                debugPanel.style.right = '10px';
                debugPanel.style.backgroundColor = 'rgba(0,0,0,0.7)';
                debugPanel.style.color = 'white';
                debugPanel.style.padding = '10px';
                debugPanel.style.borderRadius = '5px';
                debugPanel.style.fontSize = '12px';
                debugPanel.style.zIndex = '9999';
                debugPanel.style.maxWidth = '300px';
                debugPanel.style.maxHeight = '200px';
                debugPanel.style.overflow = 'auto';
                debugPanel.style.display = 'none';
                
                const toggleBtn = document.createElement('button');
                toggleBtn.textContent = 'Debug';
                toggleBtn.style.position = 'fixed';
                toggleBtn.style.bottom = '10px';
                toggleBtn.style.right = '10px';
                toggleBtn.style.zIndex = '10000';
                toggleBtn.style.padding = '5px 10px';
                toggleBtn.style.backgroundColor = '#007bff';
                toggleBtn.style.color = 'white';
                toggleBtn.style.border = 'none';
                toggleBtn.style.borderRadius = '3px';
                toggleBtn.style.cursor = 'pointer';
                
                document.body.appendChild(debugPanel);
                document.body.appendChild(toggleBtn);
                
                toggleBtn.addEventListener('click', function() {
                    debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
                });
                
                // Override console.log
                const oldLog = console.log;
                console.log = function() {
                    const args = Array.from(arguments);
                    oldLog.apply(console, args);
                    
                    const message = args.map(arg => {
                        if (typeof arg === 'object') {
                            try {
                                return JSON.stringify(arg);
                            } catch (e) {
                                return arg.toString();
                            }
                        }
                        return arg;
                    }).join(' ');
                    
                    const logEntry = document.createElement('div');
                    logEntry.textContent = message;
                    debugPanel.appendChild(logEntry);
                    
                    // Auto-scroll to bottom
                    debugPanel.scrollTop = debugPanel.scrollHeight;
                };
                
                // Override console.error
                const oldError = console.error;
                console.error = function() {
                    const args = Array.from(arguments);
                    oldError.apply(console, args);
                    
                    const message = args.map(arg => {
                        if (typeof arg === 'object') {
                            try {
                                return JSON.stringify(arg);
                            } catch (e) {
                                return arg.toString();
                            }
                        }
                        return arg;
                    }).join(' ');
                    
                    const logEntry = document.createElement('div');
                    logEntry.textContent = 'ERROR: ' + message;
                    logEntry.style.color = '#ff4444';
                    debugPanel.appendChild(logEntry);
                    
                    // Auto-scroll to bottom
                    debugPanel.scrollTop = debugPanel.scrollHeight;
                };
            }
            
            // Enable debug panel for troubleshooting
            addDebugPanel();
        });
    </script>
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="header-container">
            <div class="logo-container">
                <img src="data:image/png;base64, {{ logo }}" alt="DeepBridge Logo" class="logo">
            </div>
            <div class="title-container">
                <h1>DeepBridge Resilience Report</h1>
                <div class="report-info">
                    <div class="info-item"><strong>Model:</strong> {{ model_name }}</div>
                    <div class="info-item"><strong>Date:</strong> {{ timestamp }}</div>
                    {% if model_type is defined %}<div class="info-item"><strong>Type:</strong> {{ model_type }}</div>{% endif %}
                </div>
            </div>
        </div>
    </header>

    <div class="container">
<div class="resilience-report">
    <!-- Report header -->
    <div class="report-header card">
        <div class="header-content">
            <div class="header-info">
                <h1>Distribution Shift Resilience Analysis: {{ model_name }}</h1>
                <p>This report analyzes how well the model maintains performance when distribution shifts occur between baseline and target data.</p>
                <p><strong>Model:</strong> {{ model_type }}</p>
                <p><strong>Date:</strong> {{ timestamp }}</p>
            </div>
            <div class="header-metrics">
                {% include "report_types/resilience/components/summary/resilience_score.html" %}
                {% include "report_types/resilience/components/summary/metrics_summary.html" %}
                {% include "report_types/resilience/components/summary/model_info.html" %}
            </div>
        </div>
    </div>

    <!-- Main Tab Navigation -->
    <div class="main-tabs" id="main-tabs">
        <button class="tab-btn active" data-tab="overview">Overview</button>
        <button class="tab-btn" data-tab="details">Details</button>
        <button class="tab-btn" data-tab="distribution">Distribution Analysis</button>
    </div>

    <!-- Tab content sections -->
    <div id="overview" class="tab-content active">
        {% include "report_types/resilience/sections/overview.html" %}
    </div>
    
    <div id="details" class="tab-content">
        {% include "report_types/resilience/sections/details.html" %}
    </div>
    
    <div id="distribution" class="tab-content">
        {% include "report_types/resilience/sections/distribution.html" %}
    </div>

    <!-- Footer -->
    <div class="report-footer">
        <div class="footer-content">
            <div class="footer-info">
                <p>Generated by DeepBridge Resilience Analysis Module</p>
                <p>Version {{ resilience_module_version|default('1.0') }}</p>
            </div>
            <div class="footer-actions">
                <button class="action-button" id="export-report">Export Report</button>
                <button class="action-button" id="settings-button">Settings</button>
            </div>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div class="settings-modal" id="settings-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Report Settings</h3>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="settings-section">
                <h4>Theme</h4>
                <div class="theme-selector">
                    <label class="theme-option">
                        <input type="radio" name="theme" value="light" checked>
                        <span class="theme-preview light-theme"></span>
                        <span class="theme-name">Light</span>
                    </label>
                    <label class="theme-option">
                        <input type="radio" name="theme" value="dark">
                        <span class="theme-preview dark-theme"></span>
                        <span class="theme-name">Dark</span>
                    </label>
                </div>
            </div>
            <div class="settings-section">
                <h4>Chart Settings</h4>
                <div class="setting-item">
                    <label for="animate-charts">
                        <input type="checkbox" id="animate-charts" checked>
                        Enable chart animations
                    </label>
                </div>
                <div class="setting-item">
                    <label for="show-tooltips">
                        <input type="checkbox" id="show-tooltips" checked>
                        Show chart tooltips
                    </label>
                </div>
                <div class="setting-item">
                    <label for="chart-decimal-places">Decimal places:</label>
                    <select id="chart-decimal-places">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                </div>
            </div>
            <div class="settings-section">
                <h4>Data Display</h4>
                <div class="setting-item">
                    <label for="rows-per-page">Rows per page:</label>
                    <select id="rows-per-page">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="metric-format">
                        <select id="metric-format">
                            <option value="percent" selected>Percentage (e.g., 95%)</option>
                            <option value="decimal">Decimal (e.g., 0.95)</option>
                        </select>
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="cancel-button">Cancel</button>
            <button class="apply-button">Apply Settings</button>
        </div>
    </div>
</div>
    </div>
    
    <!-- Footer Section -->
    <footer>
        <div class="footer-content">
            <div class="copyright">
                &copy; {{ current_year }} DeepBridge. All rights reserved.
            </div>
            <div class="footer-links">
                <button onclick="printReport()" class="btn-print">Print Report</button>
            </div>
        </div>
    </footer>

    <script>
        function printReport() {
            window.print();
        }
    </script>
<!-- Report data initialization -->
<script>
    // Make report data available to components with error handling
    try {
        window.reportData = JSON.parse('{{ report_data_json|default("{}")|safe }}');
    } catch (e) {
        console.warn("Error parsing report data JSON:", e);
        window.reportData = {};
    }
    
    // Report configuration from test results (no default values)
    window.reportConfig = {
        resilience_score: {% if resilience_score is defined and resilience_score is not none %}{{ resilience_score }}{% else %}null{% endif %},
        performance_gap: {% if performance_gap is defined and performance_gap is not none %}{{ performance_gap }}{% else %}null{% endif %},
        avg_dist_shift: {% if avg_dist_shift is defined and avg_dist_shift is not none %}{{ avg_dist_shift }}{% else %}null{% endif %},
        base_performance: {% if base_score is defined and base_score is not none %}{{ base_score }}{% else %}null{% endif %},
        outlier_sensitivity: {% if outlier_sensitivity is defined and outlier_sensitivity is not none %}{{ outlier_sensitivity }}{% else %}null{% endif %},
        metric: {% if metric is defined and metric is not none %}"{{ metric }}"{% else %}null{% endif %},
        baseline_dataset: {% if baseline_dataset is defined and baseline_dataset is not none %}"{{ baseline_dataset }}"{% else %}null{% endif %},
        target_dataset: {% if target_dataset is defined and target_dataset is not none %}"{{ target_dataset }}"{% else %}null{% endif %},
        shift_scenarios: (function() {
            try {
                {% if shift_scenarios is defined and shift_scenarios is not none %}
                    return JSON.parse('{{ shift_scenarios|tojson }}');
                {% else %}
                    return [];
                {% endif %}
            } catch (e) {
                console.error("Error parsing shift_scenarios:", e);
                return [];
            }
        })(),
        sensitive_features: (function() {
            try {
                {% if sensitive_features is defined and sensitive_features is not none %}
                    return JSON.parse('{{ sensitive_features|tojson }}');
                {% else %}
                    return [];
                {% endif %}
            } catch (e) {
                console.error("Error parsing sensitive_features:", e);
                return [];
            }
        })()
    };
    
    // Function to populate metrics tables with data from reportConfig
    function populateMetricsTables() {
        console.log("Populating metrics tables with data");
        
        // Get the metrics details table
        const metricsTable = document.getElementById('metrics-details-table');
        if (!metricsTable) {
            console.log("Metrics details table not found");
            return;
        }
        
        const tableBody = metricsTable.querySelector('tbody');
        if (!tableBody) {
            console.log("Table body not found in metrics details table");
            return;
        }
        
        // Clear loading message
        tableBody.innerHTML = '';
        
        // Check if we have shift scenarios data
        if (!window.reportConfig.shift_scenarios || !window.reportConfig.shift_scenarios.length) {
            console.log("No shift scenarios data available");
            const noDataRow = document.createElement('tr');
            noDataRow.innerHTML = `<td colspan="11" class="no-data-message">No shift scenarios data available</td>`;
            tableBody.appendChild(noDataRow);
            return;
        }
        
        // Process each shift scenario
        window.reportConfig.shift_scenarios.forEach((scenario, index) => {
            try {
                // Extract metrics data from scenario if available
                const metrics = scenario.metrics || {};
                const baselinePerf = scenario.baseline_performance || 0;
                const targetPerf = scenario.target_performance || 0;
                const perfGap = scenario.performance_gap || 0;
                const scenarioName = scenario.name || `Scenario ${index + 1}`;
                
                // Create the table row
                const row = document.createElement('tr');
                row.className = 'scenario-row';
                row.setAttribute('data-scenario-id', index);
                
                // Build row HTML
                let rowHtml = `<td class="scenario-col">${scenarioName}</td>`;
                
                // Add metrics columns if available (Accuracy)
                if (metrics.Accuracy) {
                    const baseline = metrics.Accuracy.baseline || 0;
                    const target = metrics.Accuracy.target || 0;
                    const gap = metrics.Accuracy.gap || 0;
                    
                    rowHtml += `
                        <td class="baseline-col">${(baseline * 100).toFixed(2)}%</td>
                        <td class="target-col">${(target * 100).toFixed(2)}%</td>
                        <td class="gap-col ${getGapClass(gap)}">${(gap * 100).toFixed(2)}%</td>
                    `;
                } else {
                    rowHtml += `
                        <td class="baseline-col">-</td>
                        <td class="target-col">-</td>
                        <td class="gap-col">-</td>
                    `;
                }
                
                // Add metrics columns if available (F1 Score)
                if (metrics["F1 Score"]) {
                    const baseline = metrics["F1 Score"].baseline || 0;
                    const target = metrics["F1 Score"].target || 0;
                    const gap = metrics["F1 Score"].gap || 0;
                    
                    rowHtml += `
                        <td class="baseline-col">${(baseline * 100).toFixed(2)}%</td>
                        <td class="target-col">${(target * 100).toFixed(2)}%</td>
                        <td class="gap-col ${getGapClass(gap)}">${(gap * 100).toFixed(2)}%</td>
                    `;
                } else {
                    rowHtml += `
                        <td class="baseline-col">-</td>
                        <td class="target-col">-</td>
                        <td class="gap-col">-</td>
                    `;
                }
                
                // Add metrics columns if available (AUC)
                if (metrics.AUC) {
                    const baseline = metrics.AUC.baseline || 0;
                    const target = metrics.AUC.target || 0;
                    const gap = metrics.AUC.gap || 0;
                    
                    rowHtml += `
                        <td class="baseline-col">${(baseline * 100).toFixed(2)}%</td>
                        <td class="target-col">${(target * 100).toFixed(2)}%</td>
                        <td class="gap-col ${getGapClass(gap)}">${(gap * 100).toFixed(2)}%</td>
                    `;
                } else {
                    rowHtml += `
                        <td class="baseline-col">-</td>
                        <td class="target-col">-</td>
                        <td class="gap-col">-</td>
                    `;
                }
                
                // Add composite score
                rowHtml += `<td class="composite-col">${(baselinePerf * 100).toFixed(2)}%</td>`;
                
                // Set the row's HTML
                row.innerHTML = rowHtml;
                tableBody.appendChild(row);
            } catch (e) {
                console.error(`Error processing scenario ${index}:`, e);
            }
        });
        
        // After populating the details table, also populate the summary metrics table
        populateMetricsSummaryTable();
    }
    
    // Helper function to get the CSS class for the gap value
    function getGapClass(gap) {
        if (gap <= 0.05) return 'minor-gap';
        if (gap <= 0.1) return 'moderate-gap';
        if (gap <= 0.2) return 'significant-gap';
        return 'severe-gap';
    }
    
    // Function to populate the metrics summary table with aggregated data
    function populateMetricsSummaryTable() {
        // Helper function to calculate average and max from an array
        function calculateStats(values) {
            if (!values || !values.length) return { avg: 0, max: 0 };
            const sum = values.reduce((a, b) => a + b, 0);
            const avg = sum / values.length;
            const max = Math.max(...values);
            return { avg, max };
        }
        
        // Get all metrics from scenarios
        const scenarios = window.reportConfig.shift_scenarios || [];
        if (!scenarios.length) return;
        
        // Extract metric values
        const accuracyBaselineValues = [];
        const accuracyTargetValues = [];
        const accuracyGapValues = [];
        
        const f1BaselineValues = [];
        const f1TargetValues = [];
        const f1GapValues = [];
        
        const aucBaselineValues = [];
        const aucTargetValues = [];
        const aucGapValues = [];
        
        // Collect values from all scenarios
        scenarios.forEach(scenario => {
            const metrics = scenario.metrics || {};
            
            if (metrics.Accuracy) {
                if (typeof metrics.Accuracy.baseline === 'number') accuracyBaselineValues.push(metrics.Accuracy.baseline);
                if (typeof metrics.Accuracy.target === 'number') accuracyTargetValues.push(metrics.Accuracy.target);
                if (typeof metrics.Accuracy.gap === 'number') accuracyGapValues.push(metrics.Accuracy.gap);
            }
            
            if (metrics["F1 Score"]) {
                if (typeof metrics["F1 Score"].baseline === 'number') f1BaselineValues.push(metrics["F1 Score"].baseline);
                if (typeof metrics["F1 Score"].target === 'number') f1TargetValues.push(metrics["F1 Score"].target);
                if (typeof metrics["F1 Score"].gap === 'number') f1GapValues.push(metrics["F1 Score"].gap);
            }
            
            if (metrics.AUC) {
                if (typeof metrics.AUC.baseline === 'number') aucBaselineValues.push(metrics.AUC.baseline);
                if (typeof metrics.AUC.target === 'number') aucTargetValues.push(metrics.AUC.target);
                if (typeof metrics.AUC.gap === 'number') aucGapValues.push(metrics.AUC.gap);
            }
        });
        
        // Calculate statistics
        const accuracyStats = {
            baseline: calculateStats(accuracyBaselineValues),
            target: calculateStats(accuracyTargetValues),
            gap: calculateStats(accuracyGapValues)
        };
        
        const f1Stats = {
            baseline: calculateStats(f1BaselineValues),
            target: calculateStats(f1TargetValues),
            gap: calculateStats(f1GapValues)
        };
        
        const aucStats = {
            baseline: calculateStats(aucBaselineValues),
            target: calculateStats(aucTargetValues),
            gap: calculateStats(aucGapValues)
        };
        
        // Update the summary table cells
        if (accuracyBaselineValues.length) {
            document.getElementById('avg-baseline-accuracy').textContent = `${(accuracyStats.baseline.avg * 100).toFixed(2)}%`;
            document.getElementById('avg-target-accuracy').textContent = `${(accuracyStats.target.avg * 100).toFixed(2)}%`;
            document.getElementById('avg-gap-accuracy').textContent = `${(accuracyStats.gap.avg * 100).toFixed(2)}%`;
            document.getElementById('max-gap-accuracy').textContent = `${(accuracyStats.gap.max * 100).toFixed(2)}%`;
            
            const resilience = 1 - (accuracyStats.gap.avg / accuracyStats.baseline.avg);
            document.getElementById('resilience-accuracy').textContent = `${(resilience * 100).toFixed(2)}%`;
        }
        
        if (f1BaselineValues.length) {
            document.getElementById('avg-baseline-f1').textContent = `${(f1Stats.baseline.avg * 100).toFixed(2)}%`;
            document.getElementById('avg-target-f1').textContent = `${(f1Stats.target.avg * 100).toFixed(2)}%`;
            document.getElementById('avg-gap-f1').textContent = `${(f1Stats.gap.avg * 100).toFixed(2)}%`;
            document.getElementById('max-gap-f1').textContent = `${(f1Stats.gap.max * 100).toFixed(2)}%`;
            
            const resilience = 1 - (f1Stats.gap.avg / f1Stats.baseline.avg);
            document.getElementById('resilience-f1').textContent = `${(resilience * 100).toFixed(2)}%`;
        }
        
        if (aucBaselineValues.length) {
            document.getElementById('avg-baseline-auc').textContent = `${(aucStats.baseline.avg * 100).toFixed(2)}%`;
            document.getElementById('avg-target-auc').textContent = `${(aucStats.target.avg * 100).toFixed(2)}%`;
            document.getElementById('avg-gap-auc').textContent = `${(aucStats.gap.avg * 100).toFixed(2)}%`;
            document.getElementById('max-gap-auc').textContent = `${(aucStats.gap.max * 100).toFixed(2)}%`;
            
            const resilience = 1 - (aucStats.gap.avg / aucStats.baseline.avg);
            document.getElementById('resilience-auc').textContent = `${(resilience * 100).toFixed(2)}%`;
        }
        
        // Calculate composite metrics if all are available
        if (accuracyBaselineValues.length && f1BaselineValues.length && aucBaselineValues.length) {
            const avgBaselineComposite = (accuracyStats.baseline.avg + f1Stats.baseline.avg + aucStats.baseline.avg) / 3;
            const avgTargetComposite = (accuracyStats.target.avg + f1Stats.target.avg + aucStats.target.avg) / 3;
            const avgGapComposite = (accuracyStats.gap.avg + f1Stats.gap.avg + aucStats.gap.avg) / 3;
            const maxGapComposite = Math.max(accuracyStats.gap.max, f1Stats.gap.max, aucStats.gap.max);
            const compositeResilience = 1 - (avgGapComposite / avgBaselineComposite);
            
            document.getElementById('avg-baseline-composite').textContent = `${(avgBaselineComposite * 100).toFixed(2)}%`;
            document.getElementById('avg-target-composite').textContent = `${(avgTargetComposite * 100).toFixed(2)}%`;
            document.getElementById('avg-gap-composite').textContent = `${(avgGapComposite * 100).toFixed(2)}%`;
            document.getElementById('max-gap-composite').textContent = `${(maxGapComposite * 100).toFixed(2)}%`;
            document.getElementById('resilience-composite').textContent = `${(compositeResilience * 100).toFixed(2)}%`;
        }
    }

    // Initialize data display
    document.addEventListener('DOMContentLoaded', function() {
        // Populate metrics tables with data
        populateMetricsTables();
        
        // Attempt to display sensitive features in tables
        if (window.reportConfig.sensitive_features && window.reportConfig.sensitive_features.length > 0) {
            // Try to find the feature impact table
            const featureTable = document.querySelector('#feature-impact-table');
            if (featureTable) {
                const tableBody = featureTable.querySelector('tbody') || featureTable;
                if (tableBody) {
                    // Clear any existing content
                    tableBody.innerHTML = '';
                    
                    // Add rows for each feature
                    window.reportConfig.sensitive_features.forEach(function(feature, index) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${feature.name || 'Unknown'}</td>
                            <td>${typeof feature.impact === 'number' ? (feature.impact * 100).toFixed(2) + '%' : 'N/A'}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            }
        }
        
        // Display shift scenarios in tables if available
        if (window.reportConfig.shift_scenarios && window.reportConfig.shift_scenarios.length > 0) {
            // Try to find the shift results table
            const shiftTable = document.querySelector('#shift-results-table');
            if (shiftTable) {
                const tableBody = shiftTable.querySelector('tbody') || shiftTable;
                if (tableBody) {
                    // Clear any existing content
                    tableBody.innerHTML = '';
                    
                    // Add rows for each scenario
                    window.reportConfig.shift_scenarios.forEach(function(scenario, index) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${scenario.alpha ? (scenario.alpha * 100).toFixed(0) + '%' : 'N/A'}</td>
                            <td>${scenario.distance_metric || 'N/A'}</td>
                            <td>${typeof scenario.performance_gap === 'number' ? (scenario.performance_gap * 100).toFixed(2) + '%' : 'N/A'}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            }
        }
        
        // Draw charts if Plotly is available
        setTimeout(function() {
            if (typeof Plotly !== 'undefined') {
                // Containers for charts
                const perfGapContainer = document.getElementById('performance-gap-container');
                const distribContainer = document.getElementById('distribution-shift-container');
                const featureContainer = document.getElementById('feature-impact-container');
                
                // Create performance gap chart
                if (perfGapContainer) {
                    try {
                        // Create a chart container
                        const plotDiv = document.createElement('div');
                        plotDiv.id = 'performance-gap-plot';
                        plotDiv.style.width = '100%';
                        plotDiv.style.height = '300px';
                        
                        // Replace placeholder with the chart
                        const placeholder = perfGapContainer.querySelector('.chart-placeholder');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                        
                        perfGapContainer.appendChild(plotDiv);
                        
                        // Get data from config
                        const performanceGap = window.reportConfig.performance_gap;
                        const basePerformance = window.reportConfig.base_performance;
                        
                        // If data isn't available, show message
                        if (performanceGap === null || basePerformance === null) {
                            const msgDiv = document.createElement('div');
                            msgDiv.className = 'no-data-message';
                            msgDiv.innerHTML = '<p>Data not available from test results</p>';
                            perfGapContainer.appendChild(msgDiv);
                            return;
                        }
                        
                        const targetPerformance = basePerformance - performanceGap;
                        
                        // Create chart data
                        const data = [{
                            x: ['Baseline', 'Target'],
                            y: [basePerformance * 100, targetPerformance * 100],
                            type: 'bar',
                            marker: {
                                color: ['#28a745', '#dc3545']
                            },
                            text: [
                                `${(basePerformance * 100).toFixed(1)}%`, 
                                `${(targetPerformance * 100).toFixed(1)}%`
                            ],
                            textposition: 'auto'
                        }];
                        
                        // Chart layout
                        const layout = {
                            title: 'Performance Comparison',
                            yaxis: {
                                title: `${window.reportConfig.metric || 'Performance'} (%)`,
                                range: [0, 100]
                            },
                            margin: { t: 50, r: 20, b: 40, l: 60 },
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            plot_bgcolor: 'rgba(0,0,0,0)',
                        };
                        
                        // Create the chart
                        Plotly.newPlot('performance-gap-plot', data, layout);
                    } catch (e) {
                        console.error('Error creating performance chart:', e);
                    }
                }
                
                // Create distribution shift chart if container exists
                if (distribContainer) {
                    try {
                        // Create a chart container
                        const plotDiv = document.createElement('div');
                        plotDiv.id = 'distribution-shift-plot';
                        plotDiv.style.width = '100%';
                        plotDiv.style.height = '300px';
                        
                        // Replace placeholder
                        const placeholder = distribContainer.querySelector('.chart-placeholder');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                        
                        distribContainer.appendChild(plotDiv);
                        
                        // Use data from reportConfig
                        const distanceMetrics = window.reportConfig.distance_metrics || ["PSI", "KS", "WD1"];
                        const avgDistShift = window.reportConfig.avg_dist_shift;
                        
                        // Sample data for visualization
                        const data = [{
                            x: distanceMetrics,
                            y: [avgDistShift * 100, (avgDistShift * 0.8) * 100, (avgDistShift * 0.5) * 100],
                            type: 'bar',
                            marker: {
                                color: '#3498db'
                            }
                        }];
                        
                        // Chart layout
                        const layout = {
                            title: 'Distribution Shift Analysis',
                            yaxis: {
                                title: 'Shift Magnitude (%)',
                                range: [0, Math.max(avgDistShift * 120, 30)]
                            },
                            xaxis: {
                                title: 'Distance Metrics'
                            },
                            margin: { t: 50, r: 20, b: 60, l: 60 },
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            plot_bgcolor: 'rgba(0,0,0,0)',
                        };
                        
                        // Create chart
                        Plotly.newPlot('distribution-shift-plot', data, layout);
                    } catch (e) {
                        console.error('Error creating distribution shift chart:', e);
                    }
                }
                
                // Create feature impact chart if container exists
                if (featureContainer && window.reportConfig.sensitive_features) {
                    try {
                        // Create chart container
                        const plotDiv = document.createElement('div');
                        plotDiv.id = 'feature-impact-plot';
                        plotDiv.style.width = '100%';
                        plotDiv.style.height = '300px';
                        
                        // Replace placeholder
                        const placeholder = featureContainer.querySelector('.chart-placeholder');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                        
                        featureContainer.appendChild(plotDiv);
                        
                        // Get sensitive features data
                        const sensitiveFeatures = window.reportConfig.sensitive_features;
                        
                        if (!sensitiveFeatures || sensitiveFeatures.length === 0) {
                            const msgDiv = document.createElement('div');
                            msgDiv.className = 'no-data-message';
                            msgDiv.innerHTML = '<p>No feature impact data available from test results</p>';
                            featureContainer.appendChild(msgDiv);
                            return;
                        }
                        
                        // Sort features by impact
                        const sortedFeatures = sensitiveFeatures.sort((a, b) => b.impact - a.impact);
                        const featureNames = sortedFeatures.map(f => f.name);
                        const featureImpacts = sortedFeatures.map(f => f.impact * 100);
                        
                        // Create chart data
                        const data = [{
                            y: featureNames,
                            x: featureImpacts,
                            type: 'bar',
                            orientation: 'h',
                            marker: {
                                color: '#ff7043'
                            }
                        }];
                        
                        // Chart layout
                        const layout = {
                            title: 'Feature Impact Analysis',
                            xaxis: {
                                title: 'Impact on Performance (%)'
                            },
                            yaxis: {
                                title: 'Feature Name'
                            },
                            margin: { t: 50, r: 20, b: 50, l: 150 },
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            plot_bgcolor: 'rgba(0,0,0,0)',
                        };
                        
                        // Create chart
                        Plotly.newPlot('feature-impact-plot', data, layout);
                    } catch (e) {
                        console.error('Error creating feature impact chart:', e);
                    }
                }
            }
        }, 800); // Wait for DOM to be ready
    });

    // Initialize theme settings
    document.addEventListener('DOMContentLoaded', function() {
        initThemeSettings();
        initModalHandlers();
    });

    function initThemeSettings() {
        const themeRadios = document.querySelectorAll('input[name="theme"]');
        const themeStylesheet = document.getElementById('theme-stylesheet');

        themeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                const theme = this.value;
                // Theme switching code not needed since all styles are inline
                localStorage.setItem('preferredTheme', theme);
            });
        });

        // Load saved theme preference (check both keys for compatibility)
        const savedTheme = localStorage.getItem('preferredTheme') || localStorage.getItem('preferred-theme') || 'light';
        if (savedTheme) {
            const themeInput = document.querySelector(`input[name="theme"][value="${savedTheme}"]`);
            if (themeInput) {
                themeInput.checked = true;
                // Theme switching code not needed since all styles are inline
            }
        }
    }

    function initModalHandlers() {
        const settingsBtn = document.getElementById('settings-button');
        const settingsModal = document.getElementById('settings-modal');
        const closeModalBtn = document.querySelector('.close-modal');
        const cancelBtn = document.querySelector('.cancel-button');
        const applyBtn = document.querySelector('.apply-button');

        // Open modal
        settingsBtn.addEventListener('click', function() {
            settingsModal.style.display = 'block';
        });

        // Close modal handlers
        [closeModalBtn, cancelBtn].forEach(btn => {
            btn.addEventListener('click', function() {
                settingsModal.style.display = 'none';
            });
        });

        // Close when clicking outside the modal
        window.addEventListener('click', function(event) {
            if (event.target === settingsModal) {
                settingsModal.style.display = 'none';
            }
        });

        // Apply settings
        applyBtn.addEventListener('click', function() {
            // Save settings
            const animateCharts = document.getElementById('animate-charts').checked;
            const showTooltips = document.getElementById('show-tooltips').checked;
            const decimalPlaces = document.getElementById('chart-decimal-places').value;
            const rowsPerPage = document.getElementById('rows-per-page').value;
            const metricFormat = document.getElementById('metric-format').value;

            // Store settings
            const settings = {
                animateCharts,
                showTooltips,
                decimalPlaces,
                rowsPerPage,
                metricFormat
            };
            localStorage.setItem('reportSettings', JSON.stringify(settings));

            // Apply settings
            applySettings(settings);

            // Close modal
            settingsModal.style.display = 'none';
        });

        // Load saved settings
        const savedSettings = localStorage.getItem('reportSettings');
        if (savedSettings) {
            const settings = JSON.parse(savedSettings);
            
            // Update UI to reflect saved settings
            document.getElementById('animate-charts').checked = settings.animateCharts;
            document.getElementById('show-tooltips').checked = settings.showTooltips;
            document.getElementById('chart-decimal-places').value = settings.decimalPlaces;
            document.getElementById('rows-per-page').value = settings.rowsPerPage;
            document.getElementById('metric-format').value = settings.metricFormat;

            // Apply settings
            applySettings(settings);
        }
    }

    function applySettings(settings) {
        // Dispatch event to inform controllers about settings change
        window.dispatchEvent(new CustomEvent('settingsChanged', { detail: settings }));
        
        // Update tables rows per page
        document.querySelectorAll('.rows-selector').forEach(selector => {
            selector.value = settings.rowsPerPage;
            selector.dispatchEvent(new Event('change'));
        });
        
        // Update metric display format based on preference
        updateMetricDisplayFormat(settings.metricFormat);
    }

    function updateMetricDisplayFormat(format) {
        document.querySelectorAll('.metric-value').forEach(element => {
            const value = parseFloat(element.getAttribute('data-value') || 0);
            
            if (!isNaN(value)) {
                if (format === 'percent') {
                    element.textContent = `${(value * 100).toFixed(1)}%`;
                } else {
                    element.textContent = value.toFixed(4);
                }
            }
        });
    }
</script>

<!-- No external JavaScript modules, using only inline scripts -->

<!-- Non-module compatible main script -->
<script>
// Main report initialization
document.addEventListener('DOMContentLoaded', function() {
    console.log('Initializing report');
    
    // No external modules to load, we're using simplified functionality only
    console.log('Using simplified report functionality with embedded scripts only');
});
</script>

<!-- Main Navigation -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Function to initialize any tab navigation within the document
        function initializeTabNavigation(tabNavigationId) {
            const tabNavigation = document.getElementById(tabNavigationId) || document.querySelector(tabNavigationId);
            if (!tabNavigation) return;
            
            const tabButtons = tabNavigation.querySelectorAll('.tab-btn');
            const isMainNav = tabNavigationId === 'main-tabs' || tabNavigationId === '.main-tabs';
            
            // For main navigation, use the entire document's tab-content elements
            // For nested navigations, find content based on data-tab-id attributes
            const tabContainers = isMainNav 
                ? document.querySelectorAll('.tab-content') 
                : document.querySelectorAll(`[data-tab-id]`);
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    console.log(`Tab button clicked: ${tabId} in ${tabNavigationId}`);
                    
                    // Update active tab button within this navigation
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    if (isMainNav) {
                        // For main navigation, toggle based on container id
                        tabContainers.forEach(container => {
                            container.classList.toggle('active', container.id === tabId);
                        });
                    } else {
                        // For nested navigations, toggle based on data-tab-id attribute
                        tabContainers.forEach(container => {
                            const containerId = container.getAttribute('data-tab-id');
                            // If we have an exact match by ID or a match after formatting (replacing spaces, etc.)
                            const isMatch = containerId === tabId || 
                                           containerId === tabId.toLowerCase().replace(/\s+/g, '-');
                            
                            if (isMatch) {
                                container.classList.add('active');
                                console.log(`Activating container: ${containerId} for tab: ${tabId}`);
                            } else {
                                container.classList.remove('active');
                                console.log(`Deactivating container: ${containerId} (not matching ${tabId})`);
                            }
                        });
                    }
                    
                    // Trigger tab changed event for lazy loading
                    document.dispatchEvent(new CustomEvent('tab-changed', {
                        detail: { tabId: tabId, navId: tabNavigationId }
                    }));
                    
                    // Trigger resize event to ensure charts render properly
                    window.dispatchEvent(new Event('resize'));
                });
            });
        }
        
        // Function to initialize chart option selectors
        function initializeChartOptions(selectorId) {
            const selector = document.getElementById(selectorId);
            if (!selector) {
                console.log(`Chart selector not found: ${selectorId}`);
                return;
            }
            
            console.log(`Initializing chart options for: ${selectorId}`);
            
            const chartOptions = selector.querySelectorAll('.chart-option');
            const chartContainers = document.querySelectorAll('.chart-container[data-chart-type]');
            
            chartOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const optionValue = this.getAttribute('data-option');
                    console.log(`Chart option clicked: ${optionValue} in ${selectorId}`);
                    
                    // Update active chart option
                    chartOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding chart container
                    chartContainers.forEach(container => {
                        const chartType = container.getAttribute('data-chart-type');
                        const isMatch = chartType === optionValue || 
                                      chartType === optionValue.toLowerCase().replace(/\s+/g, '-');
                        
                        if (isMatch) {
                            container.classList.add('active');
                            console.log(`Activating chart container: ${container.id}`);
                        } else {
                            container.classList.remove('active');
                        }
                    });
                    
                    // Trigger resize event to ensure charts render properly
                    window.dispatchEvent(new Event('resize'));
                });
            });
            
            // Log each chart container for debugging
            chartContainers.forEach(container => {
                console.log(`Chart container: ${container.id} with type: ${container.getAttribute('data-chart-type')}`);
            });
        }
        
        // Initialize main navigation
        initializeTabNavigation('main-tabs');
        
        // Initialize other tab navigations in the document
        const otherTabNavigations = ['group_analysis_tabs', 'results_tables_tabs'];
        otherTabNavigations.forEach(navId => {
            if (document.getElementById(navId)) {
                initializeTabNavigation(navId);
                console.log(`Initialized tab navigation: ${navId}`);
                
                // Log all tab buttons in this navigation
                const nav = document.getElementById(navId);
                const buttons = nav.querySelectorAll('.tab-btn');
                buttons.forEach(btn => {
                    console.log(`Tab button in ${navId}: ${btn.getAttribute('data-tab')}`);
                });
                
                // Log all content containers that might be targets
                document.querySelectorAll('[data-tab-id]').forEach(container => {
                    console.log(`Tab container: ${container.id} with data-tab-id: ${container.getAttribute('data-tab-id')}`);
                });
            } else {
                console.log(`Tab navigation not found: ${navId}`);
            }
        });
        
        // Initialize active tab
        const activeTab = document.querySelector('.main-tabs .tab-btn.active');
        if (activeTab) {
            document.dispatchEvent(new CustomEvent('tab-changed', {
                detail: { tabId: activeTab.getAttribute('data-tab') }
            }));
        }
        
        // Initialize chart option selectors
        const chartSelectors = ['overview_charts_selector', 'intensity_charts_selector'];
        chartSelectors.forEach(selectorId => {
            if (document.getElementById(selectorId)) {
                initializeChartOptions(selectorId);
                console.log(`Initialized chart selector: ${selectorId}`);
            } else {
                console.log(`Chart selector not found: ${selectorId}`);
            }
        });
        
        // Initialize export report button
        const exportReportBtn = document.getElementById('export-report');
        if (exportReportBtn) {
            exportReportBtn.addEventListener('click', function() {
                exportReport();
            });
        }
    });
    
    // Function to export the report
    function exportReport() {
        // Create export options modal
        const modal = document.createElement('div');
        modal.className = 'export-modal';
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Export Report</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="export-options">
                        <h4>Export Format</h4>
                        <div class="option-group">
                            <label class="option-item">
                                <input type="radio" name="export-format" value="pdf" checked>
                                <span class="option-label">PDF Document</span>
                            </label>
                            <label class="option-item">
                                <input type="radio" name="export-format" value="html">
                                <span class="option-label">HTML Document</span>
                            </label>
                            <label class="option-item">
                                <input type="radio" name="export-format" value="json">
                                <span class="option-label">JSON Data</span>
                            </label>
                        </div>
                    </div>
                    <div class="export-options">
                        <h4>Content to Include</h4>
                        <div class="option-group">
                            <label class="option-item">
                                <input type="checkbox" name="include-section" value="overview" checked>
                                <span class="option-label">Overview</span>
                            </label>
                            <label class="option-item">
                                <input type="checkbox" name="include-section" value="details" checked>
                                <span class="option-label">Details</span>
                            </label>
                            <label class="option-item">
                                <input type="checkbox" name="include-section" value="distribution" checked>
                                <span class="option-label">Distribution Analysis</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="cancel-button">Cancel</button>
                    <button class="export-button">Export</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Handle export actions
        const closeBtn = modal.querySelector('.close-modal');
        const cancelBtn = modal.querySelector('.cancel-button');
        const exportBtn = modal.querySelector('.export-button');
        
        [closeBtn, cancelBtn].forEach(btn => {
            btn.addEventListener('click', function() {
                document.body.removeChild(modal);
            });
        });
        
        exportBtn.addEventListener('click', function() {
            const format = modal.querySelector('input[name="export-format"]:checked').value;
            const sections = Array.from(modal.querySelectorAll('input[name="include-section"]:checked'))
                .map(input => input.value);
            
            // Show loading indicator
            this.innerHTML = '<span class="spinner"></span> Exporting...';
            this.disabled = true;
            
            // Simulate export process
            setTimeout(() => {
                // Simulate export completion
                document.body.removeChild(modal);
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'toast-message success';
                successMessage.innerHTML = `Report exported successfully as ${format.toUpperCase()}`;
                document.body.appendChild(successMessage);
                
                // Remove success message after a few seconds
                setTimeout(() => {
                    document.body.removeChild(successMessage);
                }, 3000);
            }, 1500);
        });
    }
</script>
</body>
</html>