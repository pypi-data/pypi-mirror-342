<!-- details.html - placeholder -->
<!-- details.html - Detailed analysis section of the resilience report -->
{% block content %}

<div class="details-section">
    <div class="card">
        <h2>Detailed Analysis</h2>
        <p>This section provides detailed metrics and performance analysis for each shift scenario.</p>
        
        <!-- Filter Widget -->
        <div class="details-filter">
            <!-- Filter widget -->
            <div class="filter-widget" id="details-filter">
                <div class="filter-header">
                    <h4>Filter Scenarios</h4>
                    <button class="collapse-button">â–¼</button>
                </div>
                <div class="filter-content" style="display:none;">
                    <div class="filter-search">
                        <input type="text" placeholder="Search scenarios..." class="search-input">
                    </div>
                    <div class="filter-options">
                        <!-- Performance filters will be added by JavaScript -->
                    </div>
                    <button class="apply-filter-btn">Apply Filters</button>
                </div>
            </div>
        </div>
        
        <!-- Scenario Selector -->
        <div class="scenario-selector">
            <label for="scenario-select">Select Scenario:</label>
            <select id="scenario-select" class="scenario-select">
                <option value="all">All Scenarios</option>
                {% for scenario in shift_scenarios %}
                <option value="{{ scenario|lower|replace(' ', '-') }}">{{ scenario }}</option>
                {% endfor %}
            </select>
        </div>
        
        <!-- Performance Metrics -->
        <div class="metrics-cards">
            <div class="metrics-row">
                <div class="metric-card-container">
                    <!-- Baseline Performance Metric Card -->
                    <div class="metric-card-widget" data-metric="baseline-performance">
                        <div class="metric-card-content">
                            <div class="metric-icon">
                                <i class="metric-icon-success-metric"></i>
                            </div>
                            <div class="metric-details">
                                <div class="metric-title">Baseline Performance</div>
                                <div class="metric-value" data-value="{{ base_score }}">
                                    {% if base_score is defined and base_score is not none %}
                                        {{ (base_score * 100)|round(2) }}%
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </div>
                                <div class="metric-description">Performance on baseline distribution</div>
                            </div>
                            <div class="metric-indicator">
                                <div class="indicator-dot neutral"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="metric-card-container">
                    <!-- Target Performance Metric Card -->
                    <div class="metric-card-widget" data-metric="target-performance">
                        <div class="metric-card-content">
                            <div class="metric-icon">
                                <i class="metric-icon-success-metric"></i>
                            </div>
                            <div class="metric-details">
                                <div class="metric-title">Target Performance</div>
                                <div class="metric-value" data-value="{{ base_score }}">
                                    {% if base_score is defined and base_score is not none %}
                                        {{ (base_score * 100)|round(2) }}%
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </div>
                                <div class="metric-description">Performance on target distribution</div>
                            </div>
                            <div class="metric-indicator">
                                <div class="indicator-dot neutral"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="metric-card-container">
                    <!-- Performance Gap Metric Card -->
                    <div class="metric-card-widget" data-metric="performance-gap">
                        <div class="metric-card-content">
                            <div class="metric-icon">
                                <i class="metric-icon-impact-metric"></i>
                            </div>
                            <div class="metric-details">
                                <div class="metric-title">Performance Gap</div>
                                <div class="metric-value" data-value="{{ performance_gap }}">
                                    {% if performance_gap is defined and performance_gap is not none %}
                                        {{ (performance_gap * 100)|round(2) }}%
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </div>
                                <div class="metric-description">Drop in performance due to distribution shift</div>
                            </div>
                            <div class="metric-indicator">
                                <div class="indicator-dot neutral"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="metric-card-container">
                    <!-- Resilience Score Metric Card -->
                    <div class="metric-card-widget" data-metric="resilience-score">
                        <div class="metric-card-content">
                            <div class="metric-icon">
                                <i class="metric-icon-success-metric"></i>
                            </div>
                            <div class="metric-details">
                                <div class="metric-title">Resilience Score</div>
                                <div class="metric-value" data-value="{{ resilience_score }}">
                                    {% if resilience_score is defined and resilience_score is not none %}
                                        {{ (resilience_score * 100)|round(2) }}%
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </div>
                                <div class="metric-description">Normalized resilience to distribution shifts</div>
                            </div>
                            <div class="metric-indicator">
                                <div class="indicator-dot neutral"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Performance Breakdown by Metric -->
        <div class="performance-breakdown">
            <h3>Performance by Metric</h3>
            
            <div class="performance-charts">
                <div id="metrics-chart-container" class="chart-container">
                    <!-- Chart will be rendered by JavaScript -->
                </div>
            </div>
            
            <div class="metrics-details-container">
                {% include "report_types/resilience/components/tables/metrics_details_table.html" %}
            </div>
        </div>
        
        <!-- Class/Group Analysis -->
        <div class="class-analysis">
            <h3>Group Analysis</h3>
            <p>This analysis shows how different data groups or classes are affected by distribution shifts.</p>
            
            <!-- Tab navigation -->
            <div class="tab-navigation" id="group_analysis_tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="Overall Impact">Overall Impact</button>
                    <button class="tab-btn" data-tab="Distribution Change">Distribution Change</button>
                    <button class="tab-btn" data-tab="Per-class Metrics">Per-class Metrics</button>
                </div>
            </div>
            
            <div class="group-analysis-content">
                <div id="overall-impact-container" class="tab-content active" data-tab-id="Overall Impact">
                    <!-- Overall impact visualization will be rendered here -->
                    <div id="overall-impact-chart" class="chart-container"></div>
                </div>
                
                <div id="distribution-change-container" class="tab-content" data-tab-id="Distribution Change">
                    <!-- Distribution change visualization will be rendered here -->
                    <div id="distribution-change-chart" class="chart-container"></div>
                </div>
                
                <div id="per-class-metrics-container" class="tab-content" data-tab-id="Per-class Metrics">
                    <!-- Per-class metrics visualization will be rendered here -->
                    <div id="per-class-metrics-chart" class="chart-container"></div>
                </div>
            </div>
        </div>
        
        <!-- Sample Analysis -->
        <div class="sample-analysis">
            <h3>Sample-level Analysis</h3>
            <p>This analysis examines individual samples that are most affected by distribution shifts.</p>
            
            <div class="sample-analysis-content">
                <div class="sample-selector">
                    <label for="sample-analysis-type">Analysis Type:</label>
                    <select id="sample-analysis-type" class="analysis-type-select">
                        <option value="most-affected">Most Affected Samples</option>
                        <option value="misclassified">Newly Misclassified</option>
                        <option value="boundary">Decision Boundary Changes</option>
                    </select>
                </div>
                
                <div class="sample-table-container">
                    <!-- Sample analysis table will be rendered here -->
                    <table class="data-table sample-analysis-table">
                        <thead>
                            <tr>
                                <th>Sample ID</th>
                                <th>Baseline Prediction</th>
                                <th>Target Prediction</th>
                                <th>Prediction Change</th>
                                <th>Key Features</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Sample rows will be populated by JavaScript -->
                            <tr class="loading-row">
                                <td colspan="6">
                                    <div class="loading-indicator">Loading sample data...</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}