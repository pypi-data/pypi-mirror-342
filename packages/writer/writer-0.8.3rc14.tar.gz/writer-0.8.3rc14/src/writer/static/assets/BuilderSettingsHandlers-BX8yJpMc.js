import{d as j,i as g,a as k,c as d,o as _,e as f,E as H,f as a,q as m,M as r,ac as C,av as K,U as L,_ as N,aR as P,s as D,W as z,t as U,y as F,z as G,b as J,V as Q}from"./index-ChhimAZ-.js";import{u as X,W as O,a as V}from"./BuilderApp-CNfRViSf.js";import{a as Y}from"./useBlueprintRun-4XdGdDyn.js";import"./BaseTransitionSlideFade-Cz5sXvu2.js";import"./marked.esm-273vDTCT.js";const Z={class:"BuilderBlueprintState"},ee=j({__name:"BuilderBlueprintState",props:{blueprintId:{type:String,required:!0}},setup(y){const l=y,u=g(k.core),s=g(k.builderManager),v=d(()=>u.getComponents(l.blueprintId)),S=d(()=>v.value.map(o=>o.id)),c=d(()=>{var I,h,w;const n=(I=s.getLogEntries().filter($=>$.blueprintExecution?$.blueprintExecution.summary.some(T=>S.value.includes(T.componentId)):!1).at(0))==null?void 0:I.blueprintExecution.summary.at(-1);if(!n)return;if(n.outcome==="in_progress")return"in_progress";const p=u.getComponentById(n.componentId);return((w=(h=u.getComponentDefinition(p.type).outs)==null?void 0:h[n.outcome])==null?void 0:w.style)??"success"});return(o,n)=>(_(),f("div",Z,[c.value?c.value==="success"?H(o.$slots,"success",{key:1},()=>[n[0]||(n[0]=a("span",{class:"BuilderBlueprintState__status BuilderBlueprintState__status--success material-symbols-outlined"},"check",-1))],!0):c.value==="error"?H(o.$slots,"error",{key:2},()=>[n[1]||(n[1]=a("span",{class:"BuilderBlueprintState__status BuilderBlueprintState__status--error material-symbols-outlined"},"error",-1))],!0):c.value==="in_progress"?H(o.$slots,"running",{key:3},()=>[m(K,{class:"BuilderBlueprintState__status",color:r(C).Gray5},null,8,["color"])],!0):L("",!0):H(o.$slots,"unknown",{key:0},void 0,!0)]))}}),te=N(ee,[["__scopeId","data-v-1d213169"]]),ne=["aria-busy"],se={class:"BuilderSettingsHandlersBlueprint__title"},ie=["data-writer-tooltip"],oe={class:"BuilderSettingsHandlersBlueprint__list"},re={class:"BuilderSettingsHandlersBlueprint__list__item"},le={class:"BuilderSettingsHandlersBlueprint__list__item"},ae=j({__name:"BuilderSettingsHandlersBlueprint",props:{component:{type:Object,required:!0},eventType:{type:String,required:!0},eventDescription:{type:String,required:!1,default:void 0}},setup(y){const l=g(k.core),u=g(k.builderManager),s=y,{createAndInsertComponent:v,removeComponentsSubtree:S}=Q(l,u),c=d(()=>s.eventType.replace(/^wf-/,"").replaceAll("-"," ")),{blueprints:o,triggers:n}=P(l,d(()=>s.component.id),d(()=>s.eventType)),{run:p,isRunning:B}=Y(l,d(()=>n.value.map(e=>({blueprintId:e.parentId,branchId:e.id})))),{pushToast:I}=X();function h(){const e=o.value.map(t=>{const i=(t.content.key??"0").match(/\d+/);return i?Number(i[0]):0});return e.length===0?1:Math.max(...e)+1}async function w(){var W;const{type:e}=s.component,{name:t,events:i}=l.getComponentDefinition(e),x=`${t} - ${s.eventType}`,R=`${e}@${s.eventType.replace(/^wf-/,"")}_${h()}`;let b=(W=i==null?void 0:i[s.eventType])==null?void 0:W.eventPayloadExample;typeof b=="object"&&b!==null&&(b=JSON.stringify(b));const A=v("blueprints_blueprint","blueprints_root",void 0,{content:{key:R}},E=>{v("blueprints_uieventtrigger",E,void 0,{content:{alias:x,refComponentId:s.component.id,refEventType:s.eventType,defaultResult:b?String(b):void 0},x:96,y:96})});I({type:"success",message:`${x} added`,action:{label:"Go to blueprint",func:()=>{var E;return q(A,(E=$(A))==null?void 0:E.id)},icon:"linked_services"}})}function $(e){return l.getComponents(e).find(t=>t.type==="blueprints_uieventtrigger"&&t.content.refComponentId===s.component.id&&t.content.refEventType===s.eventType)}function M(e){const t=[e.id];l.getComponents(e.parentId).length===1&&t.push(e.parentId),S(...t)}function T(e){var t,i;return((i=(t=l.getComponentById(e.parentId))==null?void 0:t.content)==null?void 0:i.key)||"Blueprint"}function q(e,t){l.setActivePageId(e),u.setMode("blueprints"),u.setSelection(t??e,void 0,"click")}return(e,t)=>(_(),f("div",{class:"BuilderSettingsHandlersBlueprint","aria-busy":r(B)},[a("div",se,[m(z,{class:"BuilderSettingsHandlersBlueprint__title__btn",variant:"special",size:"icon","aria-label":"Run the attached blueprints",disabled:r(B),loading:r(B),onClick:r(p)},{default:D(()=>t[0]||(t[0]=[a("i",{class:"material-symbols-outlined"},"play_arrow",-1)])),_:1},8,["disabled","loading","onClick"]),a("p",null,U(c.value),1),y.eventDescription?(_(),f("span",{key:0,"data-writer-tooltip":y.eventDescription,class:"material-symbols-outlined"},"help",8,ie)):L("",!0)]),a("div",oe,[(_(!0),f(F,null,G(r(n),(i,x)=>(_(),J(V,{key:i.id,color:r(C).Blue6,"color-last":r(n).length===x+1?r(C).Blue2:r(C).Blue6},{default:D(()=>[a("div",re,[m(O,{variant:"secondary",disabled:r(B),text:T(i),"data-writer-tooltip":T(i),"data-writer-tooltip-strategy":"overflow",onClick:R=>q(i.parentId,i.id)},null,8,["disabled","text","data-writer-tooltip","onClick"]),m(te,{"blueprint-id":i.parentId},null,8,["blueprint-id"]),m(z,{variant:"neutral",size:"smallIcon","custom-size":"18px","aria-label":"Unlink blueprint","data-writer-tooltip":"This will remove the trigger but will not delete the blueprint",disabled:r(B),onClick:R=>M(i)},{default:D(()=>t[1]||(t[1]=[a("i",{class:"material-symbols-outlined"},"link_off",-1)])),_:2},1032,["disabled","onClick"])])]),_:2},1032,["color","color-last"]))),128)),m(V,{"is-last":"",color:r(C).Blue2},{default:D(()=>[a("div",le,[m(O,{variant:"primary",weight:"semibold",disabled:r(B),"left-icon":"add",text:"Create blueprint",onClick:w},null,8,["disabled"])])]),_:1},8,["color"])])],8,ne))}}),ue=N(ae,[["__scopeId","data-v-ba44ab54"]]),de={key:0,class:"BuilderSettingsHandlers"},ce={class:"BuilderSettingsHandlers__list"},pe=j({__name:"BuilderSettingsHandlers",setup(y){const l=g(k.core),u=g(k.builderManager),s=d(()=>l.getComponentById(u.firstSelectedId.value)),v=d(()=>{const{type:c}=s.value,{events:o}=l.getComponentDefinition(c),n={...o};return Object.keys({...s.value.handlers}).forEach(p=>{n[p]||(n[p]={desc:"Custom event"})}),n}),S=d(()=>u.isSingleSelectionActive.value?Object.keys(v.value).length>0:!1);return(c,o)=>S.value?(_(),f("div",de,[o[0]||(o[0]=a("div",{class:"BuilderSettingsHandlers__title"},[a("i",{class:"material-symbols-outlined"},"linked_services"),a("h3",null,"Blueprints")],-1)),a("div",ce,[(_(!0),f(F,null,G(v.value,(n,p)=>(_(),f("div",{key:p},[m(ue,{component:s.value,"event-type":p,"event-description":n.desc},null,8,["component","event-type","event-description"])]))),128))])])):L("",!0)}}),ye=N(pe,[["__scopeId","data-v-d3a42325"]]);export{ye as default};
