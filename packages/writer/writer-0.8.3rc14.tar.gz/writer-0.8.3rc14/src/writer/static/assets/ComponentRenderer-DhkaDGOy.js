import{d as O,i as $,a as f,c as m,o as T,b as U,B as pe,e as L,f as v,t as R,g as ve,h as me,r as x,p as M,w as H,F as fe,j as k,u as Z,_ as X,k as ge,l as ye,m as ee,n as J,v as N,q as te,s as _e,x as he,W as Ce,y as be,z as Se,A as ne,C as Ie,D as Pe,E as Ee,G as we,H as Me,I as Te,J as $e,K as Be,L as Q}from"./index-ChhimAZ-.js";import{f as De}from"./instancePath-BsbOTTI8.js";const Ae=10,ke=O({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(b){const o=$(f.core),c=b,p=(h,r)=>{const P=h.map(d=>o.getComponentDefinition(d)).map(d=>d==null?void 0:d.name);return`${P.slice(0,-1).join(", ")} ${P.length>1?r:""} ${P.at(-1)}`},a=m(()=>{const h=o.getContainableTypes(c.componentId);let r;return h.length<=Ae&&(r=`You can add ${p(h,"and")} components`),r});return(h,r)=>(T(),U(pe,{class:"ChildlessPlaceholder","component-id":b.componentId,message:a.value},null,8,["component-id","message"]))}}),Re=["draggable"],xe={class:"title"},Ve={class:"message"},Le=O({__name:"RenderError",props:{componentType:{type:String,required:!0},message:{type:String,required:!0},draggable:{type:Boolean,required:!1}},setup(b){const o=$(f.core),c=$(f.componentId),p=m(()=>o.getComponentById(c)),a=m(()=>{var r;return o.getComponentById((r=p.value)==null?void 0:r.parentId)}),h=m(()=>{var r;return((r=a.value)==null?void 0:r.type)==="blueprints_blueprint"});return(r,g)=>h.value?(T(),U(ve,{key:0,draggable:!1})):(T(),L("div",{key:1,class:"RenderError",draggable:b.draggable},[v("div",xe,[v("h2",null,"Error rendering "+R(b.componentType),1)]),v("div",Ve,R(b.message),1)],8,Re))}}),qe={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{type:Array,required:!0}},setup(b){const o=$(f.core),c=$(f.builderManager),p=b.componentId,a=m(()=>o.getComponentById(p)),h=me(a.value.type),r=b.instancePath,g=b.instanceData,{getEvaluatedFields:P,isComponentVisible:y}=Z(o),d=P(r),w=m(()=>o.getComponents(p,{sortedByPosition:!0})),E=m(()=>!!c&&c.getMode()!="preview"),j=m(()=>{var t;return E.value&&!a.value.isCodeManaged&&a.value.type!=="root"&&a.value.type!=="blueprints_root"&&((t=A.value)==null?void 0:t.toolkit)!=="blueprints"}),q=(t,i)=>(t?o.getContainableTypes(t):["root","blueprints_root"]).includes(i),V=x(!1),z=()=>{if(!(w.value.length>0))return k(ke,{componentId:a.value.id})},e=(t,i=0,l)=>k(oe,{componentId:t,key:`${t}:${i}`,instancePath:[...r,{componentId:t,instanceNumber:i}],instanceData:[...g,x(null)],...l??{}}),n=t=>i=>{if(!q(p,i.type)&&t==="default")return!0;const _=o.getComponentDefinition(i.type).slot??"default";return _==="*"||_===t},s=(t=0,i="default",l=()=>!0,_=!1)=>{const S=C=>!E.value||_?[]:[k("div",{"data-writer-slot-of-id":p,"data-writer-position":C})],I=w.value.filter(n(i)).filter(l),D=I.filter(C=>!C.isCodeManaged).map(C=>e(C.id,t,{contextSlot:i})),W=I.filter(C=>C.isCodeManaged).map(C=>e(C.id,t,{contextSlot:i}));return[...S(0),...D.map((C,F)=>[C,S(F+1)]).flat(),...W]},u=De(r);M(f.evaluatedFields,d),M(f.componentId,p),M(f.isBeingEdited,E),M(f.isDisabled,V),M(f.instancePath,r),M(f.instanceData,g),M(f.renderProxiedComponent,e),M(f.getChildrenVNodes,s),M(f.flattenedInstancePath,u);const B={"data-writer-id":p,"data-writer-instance-path":u},A=m(()=>o.getComponentDefinition(a.value.type)),K=m(()=>{var t;return(t=A.value)==null?void 0:t.fields}),G=x(!1);H(()=>c==null?void 0:c.isComponentIdSelected(p),t=>{G.value=t});const se=m(()=>Object.entries(K.value??{}).filter(([,t])=>t.category===fe.Style).reduce((t,[i])=>(t[i]=d[i].value,t),{}));H(se,()=>G.value=!1);const Y=m(()=>w.value.length==0),ae=m(()=>y(p,r)),re=(t,i)=>{if((!t||!(t!=null&&t.startsWith("$goToPage_")))&&!i)return _=>{o.forwardEvent(_,r,!0)};if(t!=null&&t.startsWith("$goToPage_")){const _=t.substring(10);return S=>o.setActivePageFromKey(_)}return null},ie=m(()=>{const t={};return Object.keys(A.value.events??{}).forEach(l=>{var I;const _=`on${l.charAt(0).toUpperCase()}${l.slice(1)}`,S=l===((I=a.value.binding)==null?void 0:I.eventType);t[_]=D=>{var C,F;S&&o.forwardEvent(D,r,!0);const W=((C=a.value.handlers)==null?void 0:C[l])??null;(F=re(W,S))==null||F(D)}}),t}),le=m(()=>{const t=K.value;if(!t)return;const i={};return Object.keys(t).forEach(l=>{t[l].applyStyleVariable&&d[l]&&(i[`--${l}`]=d[l].value)}),i}),ce=m(()=>{const t="cssClasses",i=K.value;if(!i||!i[t]||!d[t])return;const l=String(d[t].value),_=l==null?void 0:l.split(" ").map(I=>I.trim()),S={};return _.forEach(I=>{S[I]=!0}),S}),de=function(){return{class:{[`wf-type-${a.value.type}`]:!0,component:!0,childless:Y.value,selected:G.value,disabled:V.value,beingEdited:E.value,...ce.value},style:{...le.value,...ae.value?{}:{display:"none"}},...B,...V.value?[]:ie.value,draggable:j.value}},ue=(t,i)=>E.value?k(Le,{...t,componentType:a.value.type,message:i}):k("div");return()=>{const t=E.value?z():void 0,i=({instanceNumber:_=0,slotName:S="default",componentFilter:I=()=>!0,positionlessSlot:D=!1})=>Y.value?D?void 0:t:s(_,S,I,D),l=de();return q(a.value.parentId,a.value.type)?k(h,l,{default:i}):ue(l,"Parent is not suitable for this component")}}},oe=X(qe,[["__scopeId","data-v-738827da"]]),We={class:"counter"},Fe={class:"main"},He={class:"clearContainer"},Oe={class:"content"},je={class:"title"},ze={class:"time"},Ke={class:"message"},Ge=100,Ue=O({__name:"RendererNotifications",setup(b){const o=$(f.core),c=x(!1),p=ge("balloon"),a=ye([]),h=P=>{const{type:y,title:d,message:w,code:E}=P;a.unshift({type:y,title:d,message:w,code:E,timestampReceived:new Date}),a.splice(Ge),p.value.classList.remove("alert"),p.value.offsetWidth,p.value.classList.add("alert")};ee(()=>{o.addMailSubscription("notification",h)});const r=()=>{a.length!=0&&(c.value=!c.value)},g=()=>{a.splice(0),c.value=!1};return(P,y)=>J((T(),L("div",{class:"RendererNotifications colorTransformer",onClick:r},[v("div",{ref_key:"balloon",ref:p,class:"balloon",title:"Toggle notifications"},[y[0]||(y[0]=v("i",{class:"icon material-symbols-outlined"}," notifications ",-1)),v("div",We,R(a.length),1)],512),y[3]||(y[3]=v("div",{class:"balloonFlash"},null,-1)),J(v("div",Fe,[v("div",He,[te(Ce,{onClick:g},{default:_e(()=>y[1]||(y[1]=[v("i",{class:"material-symbols-outlined"}," clear_all ",-1),he(" Clear all ")])),_:1})]),(T(!0),L(be,null,Se(a,(d,w)=>(T(),L("div",{key:w,class:"notification"},[v("div",{class:ne(["icon",d.type])},y[2]||(y[2]=[v("i",{class:"material-symbols-outlined"}," exclamation ",-1)]),2),v("div",Oe,[v("header",null,[v("strong",je,R(d.title),1),v("span",ze,R(d.timestampReceived.toLocaleTimeString()),1)]),v("div",Ke,R(d.message),1)])]))),128))],512),[[N,c.value]])],512)),[[N,a.length>0]])}}),Xe=X(Ue,[["__scopeId","data-v-0ffb1f63"]]),Ye={class:"rootComponentArea"},Je=O({__name:"ComponentRenderer",setup(b){const o=$(f.core),c=$(f.builderManager),p=Z(o),a={},h=x({}),r=m(()=>(c==null?void 0:c.activeRootId.value)??"root");H(r,(e,n)=>{var u;h.value[n]=o.activePageId;const s=(u=h.value)==null?void 0:u[e];s&&o.setActivePageId(s)});const g=p.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),P=m(()=>{var e,n,s,u,B,A;return{...Ie,"--accentColor":(e=g.accentColor)==null?void 0:e.value,"--emptinessColor":(n=g.emptinessColor)==null?void 0:n.value,"--containerBackgroundColor":(s=g.parentIdBackgroundColor)==null?void 0:s.value,"--primaryTextColor":(u=g.primaryTextColor)==null?void 0:u.value,"--secondaryTextColor":(B=g.secondaryTextColor)==null?void 0:B.value,"--separatorColor":(A=g.separatorColor)==null?void 0:A.value}}),y=m(()=>o.frontendMessageMap.value.size>0);H(()=>{var e;return(e=g.appName)==null?void 0:e.value},e=>{e!=""&&d(e)},{immediate:!0});function d(e){const n=o.mode.value;let s;e&&n=="edit"?s=`${e} | Writer | Builder`:!e&&n=="edit"?s="Writer | Builder":e&&n=="run"?s=`${e}`:!e&&n=="run"&&(s="Writer"),document.title=s}async function w(e,n){const s=document.querySelector(`[data-writer-stylesheet-key="${e}"]`);s==null||s.remove();const u=document.createElement("link");u.dataset.writerStylesheetKey=e,u.setAttribute("href",n),u.setAttribute("rel","stylesheet"),document.head.appendChild(u)}async function E(e,n){const s=document.querySelector(`[data-writer-script-key="${e}"]`);s==null||s.remove();const u=document.createElement("script");u.dataset.writerScriptKey=e,u.src=n,u.setAttribute("rel","modulepreload"),document.head.appendChild(u)}async function j(e,n){a[e]=n,await Q(()=>import(n),[],import.meta.url)}async function q(e,n,s){const u=a[e],B=await Q(()=>import(u),[],import.meta.url);if(!B){console.warn(`The module with key "${e}" cannot be found. Please check that it has been imported.`);return}B[n](...s)}function V(){o.addMailSubscription("fileDownload",e=>{const n=document.createElement("a");n.href=e.data,n.download=e.fileName,n.click()}),o.addMailSubscription("openUrl",e=>{const n=document.createElement("a");n.href=e,n.target="_blank",n.rel="noopener noreferrer",n.click()}),o.addMailSubscription("pageChange",async e=>{(c==null?void 0:c.getMode())==="blueprints"&&c.setMode("ui"),await Me(),Te(e),o.setActivePageFromKey(e)}),o.addMailSubscription("routeVarsChange",e=>{$e(e)}),o.addMailSubscription("importStylesheet",({stylesheetKey:e,path:n})=>{w(e,n)}),o.addMailSubscription("importScript",({scriptKey:e,path:n})=>{E(e,n)}),o.addMailSubscription("importModule",({moduleKey:e,specifier:n})=>{j(e,n)}),o.addMailSubscription("functionCall",({moduleKey:e,functionName:n,args:s})=>{q(e,n,s)})}function z(){const e=Be(),n=new CustomEvent("wf-app-open",{detail:{payload:e}}),s={componentId:"root",instanceNumber:0};o.forwardEvent(n,[s],!0)}return Pe(()=>{V()}),ee(()=>{z()}),(e,n)=>(T(),L("main",{class:ne(["ComponentRenderer",{loadingActive:y.value}]),tabindex:"-1",style:we(P.value)},[te(Xe,{class:"notifications"}),n[0]||(n[0]=v("div",{class:"loadingBar"},null,-1)),v("div",Ye,[(T(),U(oe,{key:r.value,"component-id":r.value,"instance-path":[{componentId:r.value,instanceNumber:0}],"instance-data":[x(null)]},null,8,["component-id","instance-path","instance-data"])),Ee(e.$slots,"default",{},void 0,!0)])],6))}}),Ze=X(Je,[["__scopeId","data-v-f6c53567"]]);export{Ze as default};
