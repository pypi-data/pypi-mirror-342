import{d as P,ay as ce,az as pe,c as g,o as p,e as v,f as d,q,ae as me,E as G,_ as R,i as x,a as L,r as N,aK as fe,aL as J,w as W,b as D,s as T,y as S,z,t as Q,aM as ge,aN as ve,aj as Z,H as F,U as w,M as C,V as ee,u as he,W as X,x as Y}from"./index-ChhimAZ-.js";import{T as ye}from"./BuilderApp-CNfRViSf.js";import{u as Ce}from"./useComponentDescription-D9BXN1-Y.js";import"./BaseTransitionSlideFade-Cz5sXvu2.js";import"./marked.esm-273vDTCT.js";const be={class:"BuilderSidebarPanel"},_e={class:"BuilderSidebarPanel__inputContainer"},Be={class:"BuilderSidebarPanel__main"},Ie={class:"BuilderSidebarPanel__footer"},Se=P({__name:"BuilderSidebarPanel",props:ce({placeholder:{type:String,required:!0},searchCount:{type:Number,required:!1,default:void 0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const r=pe(s,"modelValue"),e=s,o=g(()=>{if(e.searchCount!==void 0)return`${e.searchCount} result${e.searchCount===1?"":"s"}`});return(t,l)=>(p(),v("div",be,[d("div",_e,[q(me,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=u=>r.value=u),class:"searchInput","left-icon":"search","data-automation-action":"search",placeholder:s.placeholder,"right-text":o.value,"enable-clear-button":""},null,8,["modelValue","placeholder","right-text"])]),d("div",Be,[G(t.$slots,"default",{},void 0,!0)]),d("div",Ie,[G(t.$slots,"footer",{},void 0,!0)])]))}}),te=R(Se,[["__scopeId","data-v-99679ce7"]]),Te={class:"header"},ke={class:"tools"},$e=["data-writer-tooltip","data-component-type","onDragstart"],we={class:"name"},De=P({__name:"BuilderSidebarToolkit",setup(s){const r=x(L.core),e=x(L.builderManager),{removeInsertionCandidacy:o}=Z(r),t=N(""),l=["Layout","Content","Input","Embed","Writer","Logic","Triggers","Other"],u=g(()=>e.getMode()=="blueprints"?"blueprints":"core"),k=g(()=>{const m=l.map(c=>[c,y(c)]).filter(([c,b])=>b.length>0);return Object.fromEntries(m)}),V=g(()=>{if(t.value)return Object.values(k.value).reduce((m,c)=>m+c.length,0)}),h=g(()=>u.value=="core"?"Core toolkit":u.value=="blueprints"?"Blueprints toolkit":"Toolkit");function y(m){const b=fe().filter(f=>{const _=J(f);return!(_.category!=m||!_.toolkit&&u.value!=="core"||_.toolkit&&_.toolkit!==u.value||_.deprecated)}).map(f=>{const{name:_,description:j,category:O}=J(f);return{type:f,name:_,description:j,category:O??"Other"}}),I=t.value.toLocaleLowerCase();return b.filter(f=>!I||f.name.toLocaleLowerCase().includes(I))}function M(m,c){e.setSelection(null),m.dataTransfer.setData(`application/json;writer=${c},`,"{}")}function A(m){o(m)}function E(m){return[`/components/${m.type}.svg`,`/components/${u.value=="blueprints"?"blueprints_":""}category_${m.category}.svg`].map(c=>ve(c))}return W(u,()=>{t.value=""}),(m,c)=>(p(),D(te,{modelValue:t.value,"onUpdate:modelValue":c[1]||(c[1]=b=>t.value=b),class:"BuilderSidebarToolkit",placeholder:h.value,"search-count":V.value},{default:T(()=>[(p(!0),v(S,null,z(k.value,(b,I)=>(p(),v("div",{key:I,class:"category"},[d("div",Te,Q(I),1),d("div",ke,[(p(!0),v(S,null,z(b,i=>(p(),v("div",{key:i.type,class:"tool","data-writer-tooltip":i.description,"data-writer-tooltip-placement":"right","data-writer-tooltip-gap":"8",draggable:"true","data-component-type":i.type,onDragend:c[0]||(c[0]=f=>A(f)),onDragstart:f=>M(f,i.type)},[q(ge,{alt:`(Icon for ${i.name})`,draggable:"false",urls:E(i)},null,8,["alt","urls"]),d("div",we,Q(i.name),1)],40,$e))),128))])]))),128))]),_:1},8,["modelValue","placeholder","search-count"]))}}),xe=R(De,[["__scopeId","data-v-7ac79aa6"]]);function ne(s,r){function e(o){if(!r.value)return!0;const t=s.getComponentDefinition(o.type);return!!(t!=null&&t.name.toLocaleLowerCase().includes(r.value)||Object.values(o.content).filter(u=>u.toLocaleLowerCase().includes(r.value)).length>0)}return{isComponentMatchingQuery:e}}function Le(s,r,e){const{isComponentMatchingQuery:o}=ne(s,r);return{searchResultCount:g(()=>{if(!r.value)return;let l=0;for(const u of s.getComponentsNested(e.value))o(u)&&l++;return l})}}function Ve(s,r,e){const{isComponentMatchingQuery:o}=ne(s,r),t=g(()=>!r.value||o(e.value));return{hasMatchingChildren:g(()=>{if(!r.value)return!0;for(const u of s.getComponentsNested(e.value.id))if(o(u))return!0;return!1}),matched:t}}const Me={class:"BuilderSidebarComponentTreeBranch__nameRight"},qe={class:"previewText"},Pe=P({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{type:String,required:!0},query:{type:String,required:!1,default:""}},emits:["expandBranch"],setup(s,{emit:r}){const e=s,o=N(),t=x(L.core),l=x(L.builderManager),u=N(!1),k=g(()=>l.isComponentIdSelected(e.componentId)),{createAndInsertComponent:V,moveComponent:h,goToComponentParentPage:y,isDraggingAllowed:M}=ee(t,l),{getComponentInfoFromDrag:A,removeInsertionCandidacy:E,isParentSuitable:m}=Z(t),{isComponentVisible:c}=he(t),b=r,I=g(()=>{var a;return((a=e.query)==null?void 0:a.toLocaleLowerCase())??""}),i=g(()=>t.getComponentById(e.componentId)),{hasMatchingChildren:f,matched:_}=Ve(t,I,i);W(f,a=>{var n;return(n=o.value)==null?void 0:n.toggleCollapse(!a)},{immediate:!0});const j=g(()=>t.getComponents(e.componentId,{sortedByPosition:!0})),{name:O,previewText:K}=Ce(t,i);async function ae(a){y(e.componentId),await F(),l.handleSelectionFromEvent(a,e.componentId,void 0,"tree"),U()}function U(){o.value&&(o.value.expand(),u.value=!1,b("expandBranch"))}function re(){var H;const a=(H=o.value)==null?void 0:H.$el;if(!a)return;const n=a.closest(".BuilderSidebarComponentTree"),B=n.getBoundingClientRect(),$=o.value.$el.offsetTop-B.height/2,ue=o.value.$el.offsetLeft-B.left-16;n.scrollTo({top:$,left:Math.max(0,ue),behavior:"smooth"})}function se(a){l.setSelection(null),a.dataTransfer.setData(`application/json;writer=${i.value.type},${i.value.id}`,"{}")}function le(a){E(a)}function ie(a){const n=A(a);if(!n)return;const{draggedType:B,draggedId:$}=n;m(e.componentId,$,B)&&a.preventDefault()}function de(a){const n=A(a);if(!n)return;const{draggedType:B,draggedId:$}=n;$?h($,i.value.id):V(B,i.value.id),E(a)}return W(l.firstSelectedItem,async a=>{a&&a.componentId===e.componentId&&a.source!="tree"&&(U(),await F(),re())},{immediate:!0}),(a,n)=>(p(),D(ye,{ref_key:"treeBranch",ref:o,class:"BuilderSidebarComponentTreeBranch","component-id":s.componentId,name:C(O),query:s.query,"has-children":j.value.length>0,"data-automation-key":i.value.type,draggable:C(M)(s.componentId),matched:C(_),selected:k.value,onSelect:ae,onDragover:ie,onDragstart:se,onDragend:le,onDrop:de},{nameRight:T(()=>[d("span",Me,[Object.keys(i.value.handlers??{}).length>0?(p(),v(S,{key:0},[n[0]||(n[0]=d("span",{class:"middot"},null,-1)),n[1]||(n[1]=d("i",{class:"material-symbols-outlined"},"bolt",-1))],64)):w("",!0),C(c)(i.value.id)?w("",!0):(p(),v(S,{key:1},[n[2]||(n[2]=d("span",{class:"middot"},null,-1)),n[3]||(n[3]=d("i",{class:"material-symbols-outlined"},"visibility_off",-1))],64)),i.value.isCodeManaged?(p(),v(S,{key:2},[n[4]||(n[4]=d("span",{class:"middot"},null,-1)),n[5]||(n[5]=d("i",{class:"material-symbols-outlined"},"terminal",-1))],64)):w("",!0),C(K)?(p(),v(S,{key:3},[n[6]||(n[6]=d("span",{class:"middot"},null,-1)),d("span",qe,Q(C(K)),1)],64)):w("",!0)])]),children:T(()=>[(p(!0),v(S,null,z(j.value,B=>(p(),D(oe,{key:B.id,"component-id":B.id,query:s.query,onExpandBranch:U},null,8,["component-id","query"]))),128))]),_:1},8,["component-id","name","query","has-children","data-automation-key","draggable","matched","selected"]))}}),oe=R(Pe,[["__scopeId","data-v-fa7f2523"]]),Re={class:"add"},Ae=P({__name:"BuilderSidebarComponentTree",setup(s){const r=x(L.core),e=x(L.builderManager),o=N(""),{createAndInsertComponent:t}=ee(r,e),l=e.activeRootId,{searchResultCount:u}=Le(r,o,l);async function k(){const h=t("page","root");r.setActivePageId(h),await F(),e.setSelection(h)}async function V(){const h=t("blueprints_blueprint","blueprints_root");r.setActivePageId(h),await F(),e.setSelection(h)}return(h,y)=>(p(),D(te,{modelValue:o.value,"onUpdate:modelValue":y[0]||(y[0]=M=>o.value=M),class:"BuilderSidebarComponentTree",placeholder:"Component tree","search-count":C(u)},{footer:T(()=>[d("div",Re,[C(l)=="root"?(p(),D(X,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:k},{default:T(()=>y[1]||(y[1]=[d("i",{class:"material-symbols-outlined"}," add ",-1),Y(" Add page")])),_:1})):w("",!0),C(l)=="blueprints_root"?(p(),D(X,{key:1,variant:"special",size:"small","data-automation-action":"add-blueprint",onClick:V},{default:T(()=>y[2]||(y[2]=[d("i",{class:"material-symbols-outlined"}," add ",-1),Y(" Add blueprint")])),_:1})):w("",!0)])]),default:T(()=>[d("div",null,[q(oe,{class:"rootBranch","component-id":C(l),query:o.value},null,8,["component-id","query"])])]),_:1},8,["modelValue","search-count"]))}}),Ee=R(Ae,[["__scopeId","data-v-85ed9a5b"]]),je={class:"BuilderSidebar"},Ne=P({__name:"BuilderSidebar",setup(s){return(r,e)=>(p(),v("div",je,[q(xe),q(Ee)]))}}),Qe=R(Ne,[["__scopeId","data-v-c1777f55"]]);export{Qe as default};
