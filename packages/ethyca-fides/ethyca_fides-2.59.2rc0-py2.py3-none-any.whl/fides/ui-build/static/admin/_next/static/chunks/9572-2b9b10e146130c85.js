"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9572],{58754:function(e,t,a){var i=a(24246),s=a(77181),n=a(70788);t.Z=e=>{let{heading:t,breadcrumbItems:a,isSticky:r=!0,children:l,rightContent:d,style:o,...c}=e;return(0,i.jsxs)("div",{...c,style:r?{position:"sticky",top:"-24px",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"40px",marginLeft:"-40px",paddingRight:"40px",marginRight:"-40px",marginTop:"-24px",left:0,zIndex:20,backgroundColor:"white",...o}:{paddingBottom:"24px",...o},children:[(0,i.jsxs)(s.jqI,{justify:"space-between",children:["string"==typeof t?(0,i.jsx)(s.X6q,{className:a||l?"pb-4":void 0,fontSize:"2xl","data-testid":"page-heading",children:t}):t,d&&(0,i.jsx)("div",{"data-testid":"page-header-right-content",children:d})]}),!!a&&(0,i.jsx)(n.m,{className:l?"pb-4":void 0,items:a,"data-testid":"page-breadcrumb"}),l]})}},97181:function(e,t,a){a.d(t,{d:function(){return o}});var i=a(24246),s=a(77181),n=a(34090),r=a(27378),l=a(91613),d=a(40324);let o=e=>{let{name:t,label:a,labelProps:o,tooltip:c,isRequired:u,layout:m="inline",...p}=e,[x,h,{setValue:v}]=(0,n.U$)(t),j=!!(h.touched&&h.error),[y,g]=(0,r.useState)("");x.value||"tags"!==p.mode&&"multiple"!==p.mode||(x.value=[]),"tags"===p.mode&&"string"==typeof x.value&&(x.value=[x.value]);let f="tags"===p.mode?(e,t)=>e?e.value!==y||x.value.includes(y)?p.optionRender?p.optionRender(e,t):e.label:'Create "'.concat(y,'"'):void 0:p.optionRender||void 0,b=e=>{g(e),p.onSearch&&p.onSearch(e)},k=(e,t)=>{v(e),p.onChange&&p.onChange(e,t)};return"inline"===m?(0,i.jsx)(s.NIc,{isInvalid:j,isRequired:u,children:(0,i.jsxs)(s.rjZ,{templateColumns:a?"1fr 3fr":"1fr",children:[a?(0,i.jsx)(d.__,{htmlFor:p.id||t,...o,children:a}):null,(0,i.jsxs)(s.jqI,{align:"center",children:[(0,i.jsxs)(s.jqI,{vertical:!0,flex:1,className:"mr-2",children:[(0,i.jsx)(s.WPr,{...x,id:p.id||t,"data-testid":"controlled-select-".concat(x.name),...p,optionRender:f,onSearch:"tags"===p.mode?b:void 0,onChange:k,value:x.value||void 0,status:j?"error":void 0}),(0,i.jsx)(d.Bc,{isInvalid:j,message:h.error,fieldName:x.name})]}),c?(0,i.jsx)(l.Z,{label:c}):null]})]})}):(0,i.jsx)(s.NIc,{isInvalid:j,isRequired:u,children:(0,i.jsxs)(s.gCW,{alignItems:"start",children:[(0,i.jsxs)(s.jqI,{align:"center",children:[a?(0,i.jsx)(d.__,{htmlFor:p.id||t,fontSize:"xs",my:0,mr:1,...o,children:a}):null,c?(0,i.jsx)(l.Z,{label:c}):null]}),(0,i.jsx)(s.WPr,{...x,id:p.id||t,"data-testid":"controlled-select-".concat(x.name),...p,optionRender:f,onSearch:"tags"===p.mode?b:void 0,onChange:k,value:x.value||void 0,status:j?"error":void 0}),(0,i.jsx)(d.Bc,{isInvalid:j,message:h.error,fieldName:x.name})]})})}},14047:function(e,t,a){a.d(t,{H:function(){return n},V:function(){return i.V}});var i=a(84306),s=a(812);let n=()=>{let{errorAlert:e}=(0,i.V)();return{handleError:t=>{let a="An unexpected error occurred. Please try again.";(0,s.Ot)(t)?a=t.data.detail:(0,s.tB)(t)&&(a=t.data.detail[0].msg),e(a)}}}},84306:function(e,t,a){a.d(t,{V:function(){return n}});var i=a(24246),s=a(77181);let n=()=>{let e=(0,s.pmc)();return{errorAlert:(t,a,n)=>{let r={...n,position:(null==n?void 0:n.position)||"top",render:e=>{let{onClose:n}=e;return(0,i.jsxs)(s.bZj,{alignItems:"normal",status:"error","data-testid":"error-alert",children:[(0,i.jsx)(s.zMQ,{}),(0,i.jsxs)(s.xuv,{children:[a&&(0,i.jsx)(s.CdC,{children:a}),(0,i.jsx)(s.XaZ,{children:t})]}),(0,i.jsx)(s.PZ7,{onClick:n,position:"relative",right:0,size:"sm",top:-1})]})}};(null==n?void 0:n.id)&&e.isActive(n.id)?e.update(n.id,r):e(r)},successAlert:(t,a,n)=>{let r={...n,position:(null==n?void 0:n.position)||"top",render:e=>{let{onClose:n}=e;return(0,i.jsxs)(s.bZj,{alignItems:"normal",status:"success",variant:"subtle","data-testid":"success-alert",children:[(0,i.jsx)(s.zMQ,{}),(0,i.jsxs)(s.xuv,{children:[a&&(0,i.jsx)(s.CdC,{children:a}),(0,i.jsx)(s.XaZ,{children:t})]}),(0,i.jsx)(s.PZ7,{onClick:n,position:"relative",right:0,size:"sm",top:-1})]})}};(null==n?void 0:n.id)&&e.isActive(n.id)?e.update(n.id,r):e(r)}}}},70788:function(e,t,a){a.d(t,{m:function(){return o}});var i=a(24246),s=a(77181),n=a(79894),r=a.n(n),l=a(27378);let{Text:d}=s.AntTypography,o=e=>{let{items:t,...a}=e,n=(0,l.useMemo)(()=>null==t?void 0:t.map((e,a)=>{let n=a===t.length-1,l={...e},o=l.onClick&&!l.href;return("string"==typeof l.title&&(l.title=(0,i.jsx)(d,{style:{color:"inherit",maxWidth:n?void 0:400},ellipsis:!n,children:l.title})),o)?l.title=(0,i.jsx)(s.wpx,{type:"text",size:"small",icon:l.icon,onClick:l.onClick,className:"ant-breadcrumb-link -mt-px px-1 text-inherit",children:l.title}):(l.icon&&(l.title=(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"anticon align-text-bottom",children:l.icon}),l.title]})),l.href&&l.title&&(l.title=(0,i.jsx)(r(),{href:l.href,className:"ant-breadcrumb-link",children:l.title}),delete l.href)),l}),[t]);return(0,i.jsx)(s.zrq,{items:n,...a})}},35258:function(e,t,a){a.d(t,{Z:function(){return R}});var i=a(24246),s=a(84720),n=a(77181),r=a(27378),l=a(52368),d=a(812),o=a(46628),c=a(65450),u=a(31883),m=a(34090),p=a(45938),x=a(95346),h=a(55484),v=a(97181),j=a(40324),y=a(62656);let g=h.Ry().shape({data_categories:h.IX(h.Z_()).min(1,"Must assign at least one data category").label("Data categories"),data_use:h.Z_().required().label("Data use"),data_subjects:h.IX(h.Z_()).min(1,"Must assign at least one data subject").label("Data subjects")}),f={data_categories:[],data_subjects:[],data_use:"",dataset_references:[],customFieldValues:{},id:"",cookies:[]},b=e=>{var t;let{customFieldValues:a,...i}=e;return{...i,name:null!==(t=e.name)&&void 0!==t?t:"",cookies:i.cookies.map(e=>({name:e,path:"/"}))}},k=e=>{let{allDataUses:t,allDataCategories:a,allDataSubjects:s,allDatasets:r,privacyDeclarationId:l,includeCookies:d,includeCustomFields:o}=e,c=r?r.map(e=>{var t;return{label:null!==(t=e.name)&&void 0!==t?t:e.fides_key,value:e.fides_key}}):[];return(0,i.jsxs)(n.Kqy,{spacing:4,children:[(0,i.jsx)(v.d,{id:"data_use",label:"Data use",name:"data_use",options:t.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"What is the system using the data for. For example, is it for third party advertising or perhaps simply providing system operations.",layout:"stacked",disabled:!!l}),(0,i.jsx)(j.j0,{id:"name",label:"Processing Activity",name:"name",variant:"stacked",tooltip:"The personal data processing activity or activities associated with this data use.",disabled:!!l}),(0,i.jsx)(v.d,{name:"data_categories",label:"Data categories",options:a.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"What type of data is your system processing? This could be various types of user or system data.",mode:"multiple",layout:"stacked",disabled:!0}),(0,i.jsx)(v.d,{name:"data_subjects",label:"Data subjects",options:s.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"Whose data are you processing? This could be customers, employees or any other type of user in your system.",mode:"multiple",layout:"stacked",disabled:!0}),d?(0,i.jsx)(v.d,{name:"cookies",label:"Cookies",mode:"tags",layout:"stacked"}):null,r?(0,i.jsx)(v.d,{name:"dataset_references",label:"Dataset references",options:c,tooltip:"Referenced Dataset fides keys used by the system.",mode:"multiple",layout:"stacked"}):null,o?(0,i.jsx)(x.uc,{resourceType:y.P6.PRIVACY_DECLARATION,resourceFidesKey:l}):null]})},_=(e,t)=>{var a,i;return e?{...e,customFieldValues:t||{},cookies:null!==(i=null===(a=e.cookies)||void 0===a?void 0:a.map(e=>e.name))&&void 0!==i?i:[]}:f},C=e=>{let{onSubmit:t,initialValues:a,allDataUses:s,privacyDeclarationId:l}=e,{customFieldValues:d,upsertCustomFields:o}=(0,x.mZ)({resourceType:y.P6.PRIVACY_DECLARATION,resourceFidesKey:l}),c=(0,r.useMemo)(()=>_(a,d),[a,d]),[u,m]=(0,r.useState)(!1),p=(0,r.useMemo)(()=>{let e=s.filter(e=>e.fides_key===c.data_use)[0];if(e)return c.name?"".concat(e.name," - ").concat(c.name):e.name},[s,c]);return{handleSubmit:async(e,a)=>{let{customFieldValues:i}=e,s=b(e),n=await t(s,a);if(n){let t=n.filter(t=>t.data_use===e.data_use&&(!t.name||t.name===e.name));t.length>0&&await o({customFieldValues:i,fides_key:t[0].id}),a.resetForm({values:e}),m(!0)}},renderHeader:e=>{let{dirty:t,boxProps:a,hideSaved:s}=e;return(0,i.jsxs)(n.xuv,{display:"flex",alignItems:"center",justifyContent:"space-between",...a,children:[p?(0,i.jsx)(n.X6q,{as:"h4",size:"xs",fontWeight:"medium",mr:4,children:p}):null,!s&&u&&!t&&c.data_use?(0,i.jsxs)(n.xvT,{fontSize:"sm","data-testid":"saved-indicator",children:[(0,i.jsx)(n.StI,{})," Saved"]}):null]})},initialValues:c}},S=e=>{let{onSubmit:t,initialValues:a,onDelete:s,...r}=e,{handleSubmit:l,renderHeader:d,initialValues:o}=C({onSubmit:t,initialValues:a,allDataUses:r.allDataUses,privacyDeclarationId:null==a?void 0:a.id});return(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:o,onSubmit:l,validationSchema:g,children:e=>{let{dirty:t}=e;return(0,i.jsxs)(m.l0,{children:[(0,i.jsx)(p.Gt,{id:"PrivacyDeclaration",name:"New Privacy Declaration"}),(0,i.jsxs)(n.Kqy,{spacing:4,children:[(0,i.jsx)(n.xuv,{"data-testid":"header",children:d({dirty:t})}),(0,i.jsx)(k,{onDelete:s,...r})]})]})}})},w=e=>{let{privacyDeclaration:t,onEdit:a,onDelete:s,includeCustomFields:r,includeCookies:l,...d}=e,{initialValues:o,renderHeader:c,handleSubmit:u}=C({initialValues:t,onSubmit:e=>a(t,e),privacyDeclarationId:t.id,...d});return(0,i.jsx)(n.Qdk,{children:e=>{let{isExpanded:a}=e;return(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:o,onSubmit:u,validationSchema:g,children:e=>{let{dirty:o}=e;return(0,i.jsxs)(m.l0,{"data-testid":"".concat(t.data_use,"-form"),children:[(0,i.jsx)(p.Gt,{id:"".concat(t.id,"-form"),name:t.id}),(0,i.jsxs)(n.KFZ,{py:4,borderBottomWidth:a?"0px":"1px",backgroundColor:a?"gray.50":void 0,"data-testid":"accordion-header-".concat(t.data_use),children:[c({dirty:o,boxProps:{flex:"1",textAlign:"left"},hideSaved:!a}),(0,i.jsx)(n.XEm,{})]}),(0,i.jsx)(n.Hk3,{backgroundColor:"gray.50",pt:0,children:(0,i.jsx)(n.Kqy,{spacing:4,children:(0,i.jsx)(k,{privacyDeclarationId:t.id,onDelete:s,includeCustomFields:r,includeCookies:l,...d})})})]})}})}})};var I=e=>{let{privacyDeclarations:t,...a}=e;return(0,i.jsx)(n.UQy,{allowToggle:!0,border:"transparent","data-testid":"privacy-declaration-accordion",children:t.map(e=>(0,i.jsx)(w,{privacyDeclaration:e,...a},e.id))})},D=e=>{let{system:t,includeCustomFields:a,includeCookies:s,onSave:l,...m}=e,p=(0,n.pmc)(),[x]=(0,c.qQ)(),[h,v]=(0,r.useState)(!1),[j,y]=(0,r.useState)(void 0),g=(0,r.useMemo)(()=>j?t.privacy_declarations.filter(e=>e.id!==j.id):t.privacy_declarations,[j,t]),f=e=>g.filter(t=>t.data_use===e.data_use&&t.name===e.name).length>0&&(p((0,o.Vo)("A declaration already exists with that data use in this system. Please supply a different data use.")),!0),b=async(e,a)=>{let i=e.map(e=>{var t;return{...e,name:null!==(t=e.name)&&void 0!==t?t:""}}),s={...t,privacy_declarations:i};return(e=>{if((0,u.D4)(e)){let t=(0,d.e$)(e.error,"An unexpected error occurred while updating the system. Please try again.");p((0,o.Vo)(t));return}return p.closeAll(),p((0,o.t5)(a?"Data use deleted":"Data use saved")),l&&l(e.data),e.data.privacy_declarations})(await x(s))},k=async(e,a)=>{if(!(a.id!==e.id&&f(a)))return b(t.privacy_declarations.map(t=>t.id===e.id?a:t))},_=async e=>{if(f(e))return;p.closeAll();let t=[...g,e],a=await b(t);return a&&y(a.filter(t=>(!t.name||t.name===e.name)&&t.data_use===e.data_use)[0]),a},C=async e=>b(t.privacy_declarations.filter(t=>t.id!==e.id),!0),w=async e=>{let t=await C(e);return t&&(v(!1),y(void 0)),t};return(0,r.useEffect)(()=>{v(!1)},[t.fides_key]),(0,i.jsxs)(n.Kqy,{spacing:3,children:[(0,i.jsx)(I,{privacyDeclarations:g,onEdit:k,onDelete:C,includeCustomFields:a,includeCookies:s,...m}),h?(0,i.jsx)(n.xuv,{backgroundColor:"gray.50",p:4,"data-testid":"new-declaration-form",children:(0,i.jsx)(S,{initialValues:j,onSubmit:_,onDelete:w,includeCustomFields:a,includeCookies:s,...m})}):null,0===t.privacy_declarations.length?(0,i.jsx)(n.xvT,{fontSize:"sm",lineHeight:5,fontWeight:"medium",pl:2,children:"No data uses"}):null]})},T=a(19043);let V=e=>{let[t]=(0,c.dB)(),a=(0,n.pmc)();return{handleUpsertSystem:async(i,s)=>{let n=[{...e,name:i.name,description:i.description}],r=await t(n);(0,T.D4)(r)?a((0,o.Vo)((0,d.e$)(r.error))):(a((0,o.t5)("Successfully saved system info")),s.resetForm({values:i}))},validationSchema:h.Ry().shape({name:h.Z_().required().label("Name"),description:h.Z_().required().label("Description")})}},z={name:"",description:""};var Z=e=>{let{system:t}=e,a="/systems/configure/".concat(t.fides_key),{handleUpsertSystem:s,validationSchema:r}=V(t);return(0,i.jsxs)(n.xuv,{children:[(0,i.jsxs)(n.kCb,{alignItems:"center",children:[(0,i.jsx)(n.xvT,{color:"gray.600",size:"md",lineHeight:6,fontWeight:"semibold",marginBottom:2,children:"System details"}),(0,i.jsx)(n.LZC,{}),(0,i.jsxs)(n._pl,{color:"complimentary.500",href:a,children:["View more",(0,i.jsx)(n.h0n,{ml:2})]})]}),(0,i.jsx)(n.xuv,{width:"100%",padding:4,borderTop:"1px solid",borderColor:"gray.200",children:(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:null!=t?t:z,validationSchema:r,onSubmit:s,children:e=>{let{isSubmitting:t,dirty:a,isValid:s}=e;return(0,i.jsxs)(m.l0,{children:[(0,i.jsx)(p.Gt,{id:"SystemInfoDrawer",name:"System Info"}),(0,i.jsx)(n.xuv,{marginTop:3,children:(0,i.jsx)(j.j0,{label:"System name",name:"name",variant:"stacked"})}),(0,i.jsx)(n.xuv,{marginTop:3,children:(0,i.jsx)(j.Ks,{label:"System description",name:"description",variant:"stacked"})}),(0,i.jsx)(n.kCb,{marginTop:6,justifyContent:"flex-end",children:(0,i.jsx)(n.wpx,{htmlType:"submit",disabled:!a||!s,loading:t,type:"primary",children:"Save"})})]})}})})]})},R=e=>{var t;let{selectedSystemId:a,resetSelectedSystemId:d}=e,o=(0,r.useMemo)(()=>!!a,[a]),{isLoading:u,...m}=(0,l.f)({includeDatasets:!1,includeDisabled:!1}),{data:p}=(0,c.rn)(a,{skip:!a});return(0,i.jsx)(n.xuv,{position:"absolute",pointerEvents:"none",top:0,left:0,right:0,bottom:0,overflow:"hidden",children:(0,i.jsx)(n.Mi4,{transition:{enter:{ease:"easeInOut",duration:.5},exit:{ease:"easeInOut",duration:.5}},direction:"right",in:o,unmountOnExit:!0,style:{zIndex:11,pointerEvents:"none",position:"absolute"},children:(0,i.jsxs)(n.xuv,{position:"absolute",right:"0px",height:"100%",width:"100%",maxWidth:"480px",pointerEvents:"auto",borderWidth:0,boxShadow:"0px 20px 25px -5px rgba(0, 0, 0, 0.1), 0px 10px 10px -5px rgba(0, 0, 0, 0.04)",display:a?"unset":"none",backgroundColor:"white","data-testid":"datamap-drawer",children:[(0,i.jsx)(n.xuv,{id:"drawer-header",borderBottomWidth:1,paddingX:6,paddingY:3,children:(0,i.jsxs)(n.kCb,{children:[(0,i.jsx)(n.kCb,{justifyContent:"space-between",alignItems:"center",height:"40px",children:(0,i.jsx)(n.xvT,{fontWeight:"semibold",fontSize:"lg",lineHeight:"7",color:"gray.900",children:null!==(t=null==p?void 0:p.name)&&void 0!==t?t:"System Information"})}),(0,i.jsx)(n.LZC,{}),(0,i.jsx)(n.kCb,{alignItems:"center",children:(0,i.jsx)(n.wpx,{icon:(0,i.jsx)(n.Two,{}),"aria-label":"Close error message",type:"text",onClick:d,"data-testid":"datamap-drawer-close"})})]})}),(0,i.jsx)(n.xuv,{id:"drawer-body",height:"calc(100% - 46px)",overflowY:"auto",padding:6,style:{scrollbarGutter:"stable"},children:p?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Z,{system:p}),(0,i.jsx)(n.xvT,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,children:"Data uses"}),(0,i.jsx)(n.xuv,{borderTop:"1px solid",borderColor:"gray.200",children:(0,i.jsx)(n.xuv,{pb:3,children:(0,i.jsx)(D,{system:p,...m})})}),(0,i.jsx)(n.xvT,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,paddingBottom:2,children:"Data flow"}),(0,i.jsx)(s.q,{system:p})]}):null})]})})})}}}]);