image: debian/stable
packages:
  - python3
  - python3-pip
  - python3-venv
sources:
  - https://git.sr.ht/~csevast/scene_rir
secrets:
  - d1a5878e-cce3-4a6a-98cd-466533df1aab
shell: true
tasks:
  - setup: |
      set -e
      cd scene_rir
      python3 -m venv venv
      source venv/bin/activate
      pip install --upgrade pip build twine
  - build:  |
      set -e
      cd scene_rir
      source venv/bin/activate
      python3 -m build
  - upload: |
      set -e
      cd scene_rir
      source venv/bin/activate
      set +x
      export TWINE_PASSWORD=$(cat ~/.ssh/d1a5878e-cce3-4a6a-98cd-466533df1aab)
      twine upload -u __token__ -p "$TWINE_PASSWORD" dist/*
      set -x
