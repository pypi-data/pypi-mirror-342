<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Corefunctionality for data preparation of sequential data for pytorch, fastai models">

<title>Corefunctions – tsfast</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6685f57f7611d95a701d58b4cc6878c0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Corefunctions – tsfast">
<meta property="og:description" content="Corefunctionality for data preparation of sequential data for pytorch, fastai models">
<meta property="og:image" content="https://daniel-om-weber.github.io/tsfast/00_data/00_core_files/figure-html/cell-93-output-1.png">
<meta property="og:site_name" content="tsfast">
<meta property="og:image:height" content="290">
<meta property="og:image:width" content="890">
<meta name="twitter:title" content="Corefunctions – tsfast">
<meta name="twitter:description" content="Corefunctionality for data preparation of sequential data for pytorch, fastai models">
<meta name="twitter:image" content="https://daniel-om-weber.github.io/tsfast/00_data/00_core_files/figure-html/cell-93-output-1.png">
<meta name="twitter:image-height" content="290">
<meta name="twitter:image-width" content="890">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">tsfast</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Corefunctions</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">tsfast</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quaternions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tensor Quaternion Module</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spectogram.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Corefunctions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tune.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hyperparameter Optimization Module</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">data/00_core.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">data/01_transforms.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">data/02_split.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">data/03_block.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">data/04_loader.ipynb</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">datasets</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">datasets/00_core.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">datasets/01_external.ipynb</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">learner</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">learner/01_callbacks.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">learner/02_losses.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">learner/03_learner.ipynb</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">models/00_layers.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">models/01_rnn.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">models/02_cnn.ipynb</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">prediction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">prediction/00_core.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">prediction/01_ar.ipynb</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">prediction/02_fransys.ipynb</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">inference/00_core.ipynb</span>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#application-structure" id="toc-application-structure" class="nav-link active" data-scroll-target="#application-structure">Application Structure</a>
  <ul class="collapse">
  <li><a href="#obj_in_lst" id="toc-obj_in_lst" class="nav-link" data-scroll-target="#obj_in_lst">obj_in_lst</a></li>
  <li><a href="#count_parameters" id="toc-count_parameters" class="nav-link" data-scroll-target="#count_parameters">count_parameters</a></li>
  <li><a href="#extract-source-items" id="toc-extract-source-items" class="nav-link" data-scroll-target="#extract-source-items">1. Extract Source Items</a>
  <ul class="collapse">
  <li><a href="#extract-file-paths" id="toc-extract-file-paths" class="nav-link" data-scroll-target="#extract-file-paths">1.1 Extract File Paths</a></li>
  <li><a href="#get_hdf_files" id="toc-get_hdf_files" class="nav-link" data-scroll-target="#get_hdf_files">get_hdf_files</a></li>
  <li><a href="#create-source-dictionaries" id="toc-create-source-dictionaries" class="nav-link" data-scroll-target="#create-source-dictionaries">1.2 Create Source Dictionaries</a></li>
  <li><a href="#apply_df_tfms" id="toc-apply_df_tfms" class="nav-link" data-scroll-target="#apply_df_tfms">apply_df_tfms</a></li>
  <li><a href="#createdict" id="toc-createdict" class="nav-link" data-scroll-target="#createdict">CreateDict</a></li>
  <li><a href="#validclmcontains" id="toc-validclmcontains" class="nav-link" data-scroll-target="#validclmcontains">ValidClmContains</a></li>
  <li><a href="#validclmis" id="toc-validclmis" class="nav-link" data-scroll-target="#validclmis">ValidClmIs</a></li>
  <li><a href="#filterclm" id="toc-filterclm" class="nav-link" data-scroll-target="#filterclm">FilterClm</a></li>
  <li><a href="#get_hdf_seq_len" id="toc-get_hdf_seq_len" class="nav-link" data-scroll-target="#get_hdf_seq_len">get_hdf_seq_len</a></li>
  <li><a href="#df_get_hdf_seq_len" id="toc-df_get_hdf_seq_len" class="nav-link" data-scroll-target="#df_get_hdf_seq_len">df_get_hdf_seq_len</a></li>
  <li><a href="#dfhdfgetseqlen" id="toc-dfhdfgetseqlen" class="nav-link" data-scroll-target="#dfhdfgetseqlen">DfHDFGetSeqLen</a></li>
  <li><a href="#dfresamplingfactor" id="toc-dfresamplingfactor" class="nav-link" data-scroll-target="#dfresamplingfactor">DfResamplingFactor</a></li>
  <li><a href="#dfhdfcreatewindows" id="toc-dfhdfcreatewindows" class="nav-link" data-scroll-target="#dfhdfcreatewindows">DfHDFCreateWindows</a></li>
  <li><a href="#dfapplyfuncsplit" id="toc-dfapplyfuncsplit" class="nav-link" data-scroll-target="#dfapplyfuncsplit">DfApplyFuncSplit</a></li>
  <li><a href="#dffilterquery" id="toc-dffilterquery" class="nav-link" data-scroll-target="#dffilterquery">DfFilterQuery</a></li>
  <li><a href="#dfdropclmexcept" id="toc-dfdropclmexcept" class="nav-link" data-scroll-target="#dfdropclmexcept">DfDropClmExcept</a></li>
  </ul></li>
  <li><a href="#convert-paths-to-sequence-objects" id="toc-convert-paths-to-sequence-objects" class="nav-link" data-scroll-target="#convert-paths-to-sequence-objects">2. Convert Paths to Sequence Objects</a>
  <ul class="collapse">
  <li><a href="#extract-sequential-data-from-hdf5-files" id="toc-extract-sequential-data-from-hdf5-files" class="nav-link" data-scroll-target="#extract-sequential-data-from-hdf5-files">2.1 Extract sequential data from hdf5-files</a></li>
  <li><a href="#calc_shift_offsets" id="toc-calc_shift_offsets" class="nav-link" data-scroll-target="#calc_shift_offsets">calc_shift_offsets</a></li>
  <li><a href="#running_mean" id="toc-running_mean" class="nav-link" data-scroll-target="#running_mean">running_mean</a></li>
  <li><a href="#downsample_mean" id="toc-downsample_mean" class="nav-link" data-scroll-target="#downsample_mean">downsample_mean</a></li>
  <li><a href="#resample_interp" id="toc-resample_interp" class="nav-link" data-scroll-target="#resample_interp">resample_interp</a></li>
  <li><a href="#hdf_extract_sequence" id="toc-hdf_extract_sequence" class="nav-link" data-scroll-target="#hdf_extract_sequence">hdf_extract_sequence</a></li>
  <li><a href="#memoize" id="toc-memoize" class="nav-link" data-scroll-target="#memoize">Memoize</a></li>
  <li><a href="#memoizemp" id="toc-memoizemp" class="nav-link" data-scroll-target="#memoizemp">MemoizeMP</a></li>
  <li><a href="#hdf2sequence-1" id="toc-hdf2sequence-1" class="nav-link" data-scroll-target="#hdf2sequence-1">HDF2Sequence</a></li>
  <li><a href="#extract-scalar-data-from-hdf5-files" id="toc-extract-scalar-data-from-hdf5-files" class="nav-link" data-scroll-target="#extract-scalar-data-from-hdf5-files">Extract Scalar data from hdf5-files</a></li>
  <li><a href="#hdf2scalars" id="toc-hdf2scalars" class="nav-link" data-scroll-target="#hdf2scalars">hdf2scalars</a></li>
  <li><a href="#hdf2scalars-1" id="toc-hdf2scalars-1" class="nav-link" data-scroll-target="#hdf2scalars-1">HDF2Scalars</a></li>
  <li><a href="#extract-scalar-from-sequence" id="toc-extract-scalar-from-sequence" class="nav-link" data-scroll-target="#extract-scalar-from-sequence">Extract Scalar from sequence</a></li>
  <li><a href="#scalarsequenceelement" id="toc-scalarsequenceelement" class="nav-link" data-scroll-target="#scalarsequenceelement">ScalarSequenceElement</a></li>
  <li><a href="#datatypes-for-sequences-and-scalars" id="toc-datatypes-for-sequences-and-scalars" class="nav-link" data-scroll-target="#datatypes-for-sequences-and-scalars">2.1 Datatypes for Sequences and Scalars</a></li>
  <li><a href="#tensorsequencesoutput" id="toc-tensorsequencesoutput" class="nav-link" data-scroll-target="#tensorsequencesoutput">TensorSequencesOutput</a></li>
  <li><a href="#tensorsequencesinput" id="toc-tensorsequencesinput" class="nav-link" data-scroll-target="#tensorsequencesinput">TensorSequencesInput</a></li>
  <li><a href="#tensorsequences" id="toc-tensorsequences" class="nav-link" data-scroll-target="#tensorsequences">TensorSequences</a></li>
  <li><a href="#totensorsequencesoutput" id="toc-totensorsequencesoutput" class="nav-link" data-scroll-target="#totensorsequencesoutput">toTensorSequencesOutput</a></li>
  <li><a href="#totensorsequencesinput" id="toc-totensorsequencesinput" class="nav-link" data-scroll-target="#totensorsequencesinput">toTensorSequencesInput</a></li>
  <li><a href="#tensorscalarsoutput" id="toc-tensorscalarsoutput" class="nav-link" data-scroll-target="#tensorscalarsoutput">TensorScalarsOutput</a></li>
  <li><a href="#tensorscalarsinput" id="toc-tensorscalarsinput" class="nav-link" data-scroll-target="#tensorscalarsinput">TensorScalarsInput</a></li>
  <li><a href="#tensorscalars" id="toc-tensorscalars" class="nav-link" data-scroll-target="#tensorscalars">TensorScalars</a></li>
  <li><a href="#low-level-with-transforms" id="toc-low-level-with-transforms" class="nav-link" data-scroll-target="#low-level-with-transforms">5.1 Low-Level with Transforms</a></li>
  </ul></li>
  <li><a href="#show-batches-and-results" id="toc-show-batches-and-results" class="nav-link" data-scroll-target="#show-batches-and-results">6. Show Batches and Results</a>
  <ul class="collapse">
  <li><a href="#plot_sequence" id="toc-plot_sequence" class="nav-link" data-scroll-target="#plot_sequence">plot_sequence</a></li>
  <li><a href="#plot_seqs_single_figure" id="toc-plot_seqs_single_figure" class="nav-link" data-scroll-target="#plot_seqs_single_figure">plot_seqs_single_figure</a></li>
  <li><a href="#plot_seqs_multi_figures" id="toc-plot_seqs_multi_figures" class="nav-link" data-scroll-target="#plot_seqs_multi_figures">plot_seqs_multi_figures</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/daniel-om-weber/tsfast/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Corefunctions</h1>
</div>

<div>
  <div class="description">
    Corefunctionality for data preparation of sequential data for pytorch, fastai models
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="application-structure" class="level1">
<h1>Application Structure</h1>
<p>The data will be extracted and prepared via transforms. Those are grouped in: - Type Transforms: Those extraxt the needed components from the source items, like input sequences or target scalar values. The work on single tensors. - Item Transforms: Those Transforms may work on tuple level and therefore may process relationships between input and output. - Batch Transform: Those transforms work on batch level. They receive batched tensors and may apply lazy transforms like normalization very effeciently.</p>
<p>An application example may look like the following: - sourceitems: - path extraction with hdf5 file endings - create pandas dataframe with information for type transforms, like slices - filter items in pandas dataframe - type transforms: - extract hdf5 input and output sequence - create windows - item transforms: - filter sequence by value - shift output sequence by 1 element - batch transforms: - noise injection - normalization</p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L18" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="obj_in_lst" class="level3">
<h3 class="anchored" data-anchor-id="obj_in_lst">obj_in_lst</h3>
<blockquote class="blockquote">
<pre><code> obj_in_lst (lst, cls)</code></pre>
</blockquote>
<p><em>retrieve first object of type cls from a list</em></p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L23" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="count_parameters" class="level3">
<h3 class="anchored" data-anchor-id="count_parameters">count_parameters</h3>
<blockquote class="blockquote">
<pre><code> count_parameters (model)</code></pre>
</blockquote>
<p><em>retrieve number of trainable parameters of a model</em></p>
</section>
<section id="extract-source-items" class="level2">
<h2 class="anchored" data-anchor-id="extract-source-items">1. Extract Source Items</h2>
<p>The file paths may be extracted with <code>get_files</code> of fastai2. <a href="https://daniel-om-weber.github.io/tsfast/00_data/core.html#get_hdf_files"><code>get_hdf_files</code></a> removes the need of writing the hdf5 file extension.</p>
<p>Then a pandas dataframe may be created in case further information for the source items need to be stored like slices for the windowing function.</p>
<section id="extract-file-paths" class="level3">
<h3 class="anchored" data-anchor-id="extract-file-paths">1.1 Extract File Paths</h3>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nbdev.config <span class="im">import</span> get_config</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> get_config().config_file.parent</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>f_path <span class="op">=</span> project_root <span class="op">/</span> <span class="st">'test_data/WienerHammerstein'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>hdf_files <span class="op">=</span> get_files(f_path,extensions<span class="op">=</span><span class="st">'.hdf5'</span>,recurse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(hdf_files),hdf_files[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(3,
 Path('/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5'))</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L29" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_hdf_files" class="level3">
<h3 class="anchored" data-anchor-id="get_hdf_files">get_hdf_files</h3>
<blockquote class="blockquote">
<pre><code> get_hdf_files (path, recurse=True, folders=None)</code></pre>
</blockquote>
<p><em>Get hdf5 files in <code>path</code> recursively, only in <code>folders</code>, if specified.</em></p>
<div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>hdf_files <span class="op">=</span> get_hdf_files(f_path)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(hdf_files),hdf_files[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(3,
 Path('/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5'))</code></pre>
</div>
</div>
</section>
<section id="create-source-dictionaries" class="level3">
<h3 class="anchored" data-anchor-id="create-source-dictionaries">1.2 Create Source Dictionaries</h3>
<p>In order to extract mulitple realizations of one file with different modifications, we create a list of properties. Pandas Dataframes are to slow for iteration but very fast and convenient for creations. So after creation of the pandas Dataframe we convert it to a list of dictionaries.</p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L34" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="apply_df_tfms" class="level3">
<h3 class="anchored" data-anchor-id="apply_df_tfms">apply_df_tfms</h3>
<blockquote class="blockquote">
<pre><code> apply_df_tfms (src, pd_tfms=None)</code></pre>
</blockquote>
<p><em>Create Pandas Dataframe out of a list of items, with a list of df transforms applied</em></p>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> apply_df_tfms(hdf_files)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">path</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>test_eq(apply_df_tfms(hdf_files),apply_df_tfms(apply_df_tfms(hdf_files)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L46" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="createdict" class="level3">
<h3 class="anchored" data-anchor-id="createdict">CreateDict</h3>
<blockquote class="blockquote">
<pre><code> CreateDict (pd_tfms=None)</code></pre>
</blockquote>
<p><em>Create List of Dictionarys out of a list of items, with a list of df transforms applied</em></p>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>l_dict <span class="op">=</span>CreateDict()(hdf_files)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>l_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5'},
 {'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5'},
 {'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5'}]</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L58" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="validclmcontains" class="level3">
<h3 class="anchored" data-anchor-id="validclmcontains">ValidClmContains</h3>
<blockquote class="blockquote">
<pre><code> ValidClmContains (lst_valid)</code></pre>
</blockquote>
<p><em>add validation column using a list of strings that are part of the validation frames</em></p>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>lst_valid <span class="op">=</span> [<span class="st">'valid'</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>CreateDict([ValidClmContains(lst_valid)])(hdf_files)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 432 μs, sys: 4 μs, total: 436 μs
Wall time: 449 μs</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>[{'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5',
  'valid': True},
 {'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5',
  'valid': False},
 {'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5',
  'valid': False}]</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L68" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="validclmis" class="level3">
<h3 class="anchored" data-anchor-id="validclmis">ValidClmIs</h3>
<blockquote class="blockquote">
<pre><code> ValidClmIs (lst_valid)</code></pre>
</blockquote>
<p><em>adds validation column using a list of validation filenames</em></p>
<div id="cell-21" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>lst_valid <span class="op">=</span> [<span class="st">'test_data/battery/train/Sim_RealisticCycle2.hdf5'</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="st">'test_data/battery/valid/Sim_RealisticCycle3.hdf5'</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>CreateDict([ValidClmIs(lst_valid)])(hdf_files)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 275 μs, sys: 7 μs, total: 282 μs
Wall time: 284 μs</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>[{'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5',
  'valid': False},
 {'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5',
  'valid': False},
 {'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5',
  'valid': False}]</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L77" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="filterclm" class="level3">
<h3 class="anchored" data-anchor-id="filterclm">FilterClm</h3>
<blockquote class="blockquote">
<pre><code> FilterClm (clm_name, func=&lt;function &lt;lambda&gt;&gt;)</code></pre>
</blockquote>
<p><em>adds validation column using a list of validation filenames</em></p>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>CreateDict([ValidClmIs(lst_valid),FilterClm(<span class="st">'valid'</span>)])(hdf_files)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[]</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L85" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_hdf_seq_len" class="level3">
<h3 class="anchored" data-anchor-id="get_hdf_seq_len">get_hdf_seq_len</h3>
<blockquote class="blockquote">
<pre><code> get_hdf_seq_len (df, clm, ds=None)</code></pre>
</blockquote>
<p><em>extract the sequence length of the dataset with the ‘clm’ name and ‘f_path’ path</em></p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L93" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="df_get_hdf_seq_len" class="level3">
<h3 class="anchored" data-anchor-id="df_get_hdf_seq_len">df_get_hdf_seq_len</h3>
<blockquote class="blockquote">
<pre><code> df_get_hdf_seq_len (df, clm, ds=None)</code></pre>
</blockquote>
<p><em>extracts the sequence length of every file in advance to prepare repeated window extractions with ‘DfHDFCreateWindows’</em></p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L100" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dfhdfgetseqlen" class="level3">
<h3 class="anchored" data-anchor-id="dfhdfgetseqlen">DfHDFGetSeqLen</h3>
<blockquote class="blockquote">
<pre><code> DfHDFGetSeqLen (clm)</code></pre>
</blockquote>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df_get_hdf_seq_len(df,<span class="st">'u'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">path</th>
<th data-quarto-table-cell-role="th">seq_len</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>DfHDFGetSeqLen(<span class="st">'u'</span>)(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">path</th>
<th data-quarto-table-cell-role="th">seq_len</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L107" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dfresamplingfactor" class="level3">
<h3 class="anchored" data-anchor-id="dfresamplingfactor">DfResamplingFactor</h3>
<blockquote class="blockquote">
<pre><code> DfResamplingFactor (src_fs, lst_targ_fs)</code></pre>
</blockquote>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>targ_fs <span class="op">=</span> [<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">300</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(DfResamplingFactor(<span class="dv">100</span>,targ_fs)(df)),<span class="dv">9</span>)   </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'src_fs'</span>] <span class="op">=</span> <span class="fl">200.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(DfResamplingFactor(<span class="st">'src_fs'</span>,targ_fs)(df)),<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L133" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dfhdfcreatewindows" class="level3">
<h3 class="anchored" data-anchor-id="dfhdfcreatewindows">DfHDFCreateWindows</h3>
<blockquote class="blockquote">
<pre><code> DfHDFCreateWindows (win_sz, stp_sz, clm, fixed_start=False,
                     fixed_end=False)</code></pre>
</blockquote>
<p><em>create windows of sequences, splits sequence into multiple items</em></p>
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>create_win <span class="op">=</span> DfHDFCreateWindows(win_sz<span class="op">=</span><span class="fl">100.2</span>,stp_sz<span class="op">=</span><span class="dv">100</span>,clm<span class="op">=</span><span class="st">'u'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>win_df <span class="op">=</span> create_win(df)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>win_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 710 μs, sys: 496 μs, total: 1.21 ms
Wall time: 807 μs</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">path</th>
<th data-quarto-table-cell-role="th">seq_len</th>
<th data-quarto-table-cell-role="th">src_fs</th>
<th data-quarto-table-cell-role="th">l_slc</th>
<th data-quarto-table-cell-role="th">r_slc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>0</td>
<td>100.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>100</td>
<td>200.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>200</td>
<td>300.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>300</td>
<td>400.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>400</td>
<td>500.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>79400</td>
<td>79500.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>79500</td>
<td>79600.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>79600</td>
<td>79700.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>79700</td>
<td>79800.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>79800</td>
<td>79900.2</td>
</tr>
</tbody>
</table>

<p>1877 rows × 5 columns</p>
</div>
</div>
</div>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>win_df <span class="op">=</span> DfHDFCreateWindows(win_sz<span class="op">=</span><span class="dv">20_000</span>,stp_sz<span class="op">=</span><span class="dv">1000</span>,clm<span class="op">=</span><span class="st">'u'</span>)(df)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(win_df),<span class="dv">131</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>win_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">path</th>
<th data-quarto-table-cell-role="th">seq_len</th>
<th data-quarto-table-cell-role="th">src_fs</th>
<th data-quarto-table-cell-role="th">l_slc</th>
<th data-quarto-table-cell-role="th">r_slc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>0</td>
<td>20000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
<td>200.0</td>
<td>0</td>
<td>20000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
<td>200.0</td>
<td>1000</td>
<td>21000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
<td>200.0</td>
<td>2000</td>
<td>22000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
<td>200.0</td>
<td>3000</td>
<td>23000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>56000</td>
<td>76000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>57000</td>
<td>77000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>58000</td>
<td>78000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>59000</td>
<td>79000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>60000</td>
<td>80000</td>
</tr>
</tbody>
</table>

<p>131 rows × 5 columns</p>
</div>
</div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>test_eq(create_win(df_get_hdf_seq_len(df,<span class="st">'u'</span>)) , create_win(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>res_win_df <span class="op">=</span> create_win(DfResamplingFactor(<span class="dv">20</span>,[<span class="fl">0.1</span>])(df))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>res_win_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">path</th>
<th data-quarto-table-cell-role="th">seq_len</th>
<th data-quarto-table-cell-role="th">src_fs</th>
<th data-quarto-table-cell-role="th">targ_fs</th>
<th data-quarto-table-cell-role="th">resampling_factor</th>
<th data-quarto-table-cell-role="th">l_slc</th>
<th data-quarto-table-cell-role="th">r_slc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
<td>200.0</td>
<td>0.1</td>
<td>0.005</td>
<td>0</td>
<td>100.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
<td>200.0</td>
<td>0.1</td>
<td>0.005</td>
<td>100</td>
<td>200.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
<td>200.0</td>
<td>0.1</td>
<td>0.005</td>
<td>200</td>
<td>300.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
<td>200.0</td>
<td>0.1</td>
<td>0.005</td>
<td>300</td>
<td>400.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>0.1</td>
<td>0.005</td>
<td>0</td>
<td>100.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>0.1</td>
<td>0.005</td>
<td>100</td>
<td>200.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>0.1</td>
<td>0.005</td>
<td>200</td>
<td>300.2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(res_win_df),<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>query_expr <span class="op">=</span> <span class="st">'l_slc &lt;= 200'</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>filt_df <span class="op">=</span> win_df.query(query_expr)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>filt_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">path</th>
<th data-quarto-table-cell-role="th">seq_len</th>
<th data-quarto-table-cell-role="th">src_fs</th>
<th data-quarto-table-cell-role="th">l_slc</th>
<th data-quarto-table-cell-role="th">r_slc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>0</td>
<td>20000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/test/WienerHammerstein_test.hdf5</td>
<td>88000</td>
<td>200.0</td>
<td>0</td>
<td>20000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>0</td>
<td>20000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L169" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dfapplyfuncsplit" class="level3">
<h3 class="anchored" data-anchor-id="dfapplyfuncsplit">DfApplyFuncSplit</h3>
<blockquote class="blockquote">
<pre><code> DfApplyFuncSplit (split_func, func1, func2)</code></pre>
</blockquote>
<p><em>apply two different functions on the dataframe, func1 on the first indices of split_func, func2 on the second indices. Split_func is a Training, Validation split function</em></p>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>create_win_split <span class="op">=</span> DfApplyFuncSplit(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    IndexSplitter([<span class="dv">1</span>,<span class="dv">2</span>]),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    DfHDFCreateWindows(win_sz<span class="op">=</span><span class="dv">10000</span>,stp_sz<span class="op">=</span><span class="dv">1</span>,clm<span class="op">=</span><span class="st">'u'</span>),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    DfHDFCreateWindows(win_sz<span class="op">=</span><span class="dv">10000</span>,stp_sz<span class="op">=</span><span class="dv">10000</span>,clm<span class="op">=</span><span class="st">'u'</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>create_win_split(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">path</th>
<th data-quarto-table-cell-role="th">seq_len</th>
<th data-quarto-table-cell-role="th">src_fs</th>
<th data-quarto-table-cell-role="th">l_slc</th>
<th data-quarto-table-cell-role="th">r_slc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>0</td>
<td>10000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>1</td>
<td>10001</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>2</td>
<td>10002</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>3</td>
<td>10003</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5</td>
<td>20000</td>
<td>200.0</td>
<td>4</td>
<td>10004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>30000</td>
<td>40000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>40000</td>
<td>50000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>50000</td>
<td>60000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>60000</td>
<td>70000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>/Users/daniel/Development/tsfast/test_data/WienerHammerstein/train/WienerHammerstein_train.hdf5</td>
<td>80000</td>
<td>200.0</td>
<td>70000</td>
<td>80000</td>
</tr>
</tbody>
</table>

<p>10017 rows × 5 columns</p>
</div>
</div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L180" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dffilterquery" class="level3">
<h3 class="anchored" data-anchor-id="dffilterquery">DfFilterQuery</h3>
<blockquote class="blockquote">
<pre><code> DfFilterQuery (query)</code></pre>
</blockquote>
<div id="cell-41" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>test_eq(DfFilterQuery(query_expr)(win_df),filt_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>tfm_src <span class="op">=</span> CreateDict([ValidClmContains([<span class="st">'valid'</span>]),DfHDFCreateWindows(win_sz<span class="op">=</span><span class="dv">100</span><span class="op">+</span><span class="dv">1</span>,stp_sz<span class="op">=</span><span class="dv">10</span>,clm<span class="op">=</span><span class="st">'u'</span>)])</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>src_dicts <span class="op">=</span> tfm_src(hdf_files)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>src_dicts[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 7.65 ms, sys: 1.21 ms, total: 8.86 ms
Wall time: 8.36 ms</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>[{'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5',
  'valid': True,
  'l_slc': 0,
  'r_slc': 101},
 {'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5',
  'valid': True,
  'l_slc': 10,
  'r_slc': 111},
 {'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5',
  'valid': True,
  'l_slc': 20,
  'r_slc': 121},
 {'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5',
  'valid': True,
  'l_slc': 30,
  'r_slc': 131},
 {'path': '/Users/daniel/Development/tsfast/test_data/WienerHammerstein/valid/WienerHammerstein_valid.hdf5',
  'valid': True,
  'l_slc': 40,
  'r_slc': 141}]</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L186" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dfdropclmexcept" class="level3">
<h3 class="anchored" data-anchor-id="dfdropclmexcept">DfDropClmExcept</h3>
<blockquote class="blockquote">
<pre><code> DfDropClmExcept (clms=['path', 'l_slc', 'r_slc', 'p_sample',
                  'resampling_factor'])</code></pre>
</blockquote>
<p><em>drop unused dataframe columns as a last optional step to accelerate dictionary conversion</em></p>
</section>
</section>
<section id="convert-paths-to-sequence-objects" class="level2">
<h2 class="anchored" data-anchor-id="convert-paths-to-sequence-objects">2. Convert Paths to Sequence Objects</h2>
<p>Der Pfad wird unter Angabe der Spaltennamen in Sequenzen und Skalare Werte umgewandelt, um so am Ende ein 3-Tupel zu erhalten aus: - (Sequence, Scalar, Sequence) &lt;-&gt; (input,input,output)</p>
<section id="extract-sequential-data-from-hdf5-files" class="level3">
<h3 class="anchored" data-anchor-id="extract-sequential-data-from-hdf5-files">2.1 Extract sequential data from hdf5-files</h3>
<p>Two different functions, based on pandas df and on lists</p>
<section id="shift-time-series" class="level4">
<h4 class="anchored" data-anchor-id="shift-time-series">2.1.1 Shift time Series</h4>
<p>Sometimes we need to shift columns of a sequence by a specific value. Then we cant simply slice the array but have to handle each column individually. First a performance test has to be made.</p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L193" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="calc_shift_offsets" class="level3">
<h3 class="anchored" data-anchor-id="calc_shift_offsets">calc_shift_offsets</h3>
<blockquote class="blockquote">
<pre><code> calc_shift_offsets (clm_shift)</code></pre>
</blockquote>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>shft <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>calc_shift_offsets(shft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(array([1, 1, 0, 2]), array([-1, -1, -2,  0]), np.int64(2))</code></pre>
</div>
</div>
<p>both shifting methods have their own performance character. vstack needs double the time on short sequences, while the creation of a seperate array with copy becomes worse starting at around 5000 elements</p>
<div id="cell-50" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ta = array([[1,2,3]*2]*10000)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-51" class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%timeit</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># y = np.vstack([ta[i:-ta.shape[1]+i,i] for i in range(ta.shape[1])]).T</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-52" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%timeit</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># x = np.zeros((ta.shape[0]-ta.shape[1],ta.shape[1]))</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for i in range(ta.shape[1]):</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     x[:,i] = ta[i:-ta.shape[1]+i,i]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="hdf2sequence" class="level4">
<h4 class="anchored" data-anchor-id="hdf2sequence">2.1.2 HDF2Sequence</h4>
<p>HDF5 performance is massively affected by the dtype of the signals. f4 (32 bit floating point) Numbers are faster to load and lead to smaller files then f8 numbers.</p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L203" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="running_mean" class="level3">
<h3 class="anchored" data-anchor-id="running_mean">running_mean</h3>
<blockquote class="blockquote">
<pre><code> running_mean (x, N)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L208" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="downsample_mean" class="level3">
<h3 class="anchored" data-anchor-id="downsample_mean">downsample_mean</h3>
<blockquote class="blockquote">
<pre><code> downsample_mean (x, N)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L217" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="resample_interp" class="level3">
<h3 class="anchored" data-anchor-id="resample_interp">resample_interp</h3>
<blockquote class="blockquote">
<pre><code> resample_interp (x, resampling_factor, sequence_first=True,
                  lowpass_cut=1.0, upsample_cubic_cut=None)</code></pre>
</blockquote>
<p>*signal resampling using linear or cubic interpolation</p>
<p>x: signal to resample with shape: features x resampling_dimension or resampling_dimension x features if sequence_first=True resampling_factor: Factor &gt; 0 that scales the signal lowpass_cut: Upper boundary for resampling_factor that activates the lowpassfilter, low values exchange accuracy for performance, default is 0.7 upsample_cubic_cut: Lower boundary for resampling_factor that activates cubic interpolation at high upsampling values. Improves signal dynamics in exchange of performance. None deactivates cubic interpolation*</p>
<div id="cell-57" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.normal(size<span class="op">=</span>(<span class="dv">100000</span>,<span class="dv">9</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>test_eq(resample_interp(x,<span class="fl">0.3</span>).shape[<span class="dv">0</span>],<span class="dv">30000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/pc/13zbh_m514n1tp522cx9npt00000gn/T/ipykernel_31734/551091804.py:35: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  x = array(nn.functional.interpolate(x_int, size=targ_size, mode='linear',align_corners=False)[0])</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L260" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hdf_extract_sequence" class="level3">
<h3 class="anchored" data-anchor-id="hdf_extract_sequence">hdf_extract_sequence</h3>
<blockquote class="blockquote">
<pre><code> hdf_extract_sequence (hdf_path, clms, dataset=None, l_slc=None,
                       r_slc=None, resampling_factor=None, fs_idx=None,
                       dt_idx=False, fast_resample=True)</code></pre>
</blockquote>
<p>*extracts a sequence with the shape [seq_len x num_features]</p>
<p>hdf_path: file path of hdf file, may be a string or path type clms: list of dataset names of sequences in hdf file dataset: dataset root for clms. Useful for multiples sequences stored in one file. l_slc: left boundary for extraction of a window of the whole sequence r_slc: right boundary for extraction of a window of the whole sequence resampling_factor: scaling factor for the sequence length, uses ‘resample_interp’ for resampling fs_idx: clms list idx of fs entry in sequence. Will be scaled by resampling_factor after resampling dt_idx: clms list idx of dt entry in sequence. Will be scaled by resampling_factor after resampling fast_resample: if True, uses linear interpolation with anti-aliasing filter for faster resampling. Is less accurate than fft based resampling*</p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L299" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="memoize" class="level3">
<h3 class="anchored" data-anchor-id="memoize">Memoize</h3>
<blockquote class="blockquote">
<pre><code> Memoize (fn)</code></pre>
</blockquote>
<p><em>Initialize self. See help(type(self)) for accurate signature.</em></p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L313" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="memoizemp" class="level3">
<h3 class="anchored" data-anchor-id="memoizemp">MemoizeMP</h3>
<blockquote class="blockquote">
<pre><code> MemoizeMP (fn)</code></pre>
</blockquote>
<p><em>Initialize self. See help(type(self)) for accurate signature.</em></p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L363" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hdf2sequence-1" class="level3">
<h3 class="anchored" data-anchor-id="hdf2sequence-1">HDF2Sequence</h3>
<blockquote class="blockquote">
<pre><code> HDF2Sequence (clm_names, clm_shift=None, truncate_sz=None,
               to_cls=&lt;function noop&gt;, cached=True, fs_idx=None,
               dt_idx=None, fast_resample=True)</code></pre>
</blockquote>
<p><em>Delegates (<code>__call__</code>,<code>decode</code>,<code>setup</code>) to (<code>encodes</code>,<code>decodes</code>,<code>setups</code>) if <code>split_idx</code> matches</em></p>
<div id="cell-62" class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%timeit</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>hdf2seq <span class="op">=</span> HDF2Sequence([<span class="st">'u'</span>,<span class="st">'y'</span>],cached<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>hdf2seq(hdf_files[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[ 0.27021001,  0.24308601],
       [ 0.14557693,  0.23587583],
       [ 0.05459135,  0.23415912],
       ...,
       [ 0.78831281, -0.1781944 ],
       [ 0.61458185, -0.14866701],
       [ 0.55758711, -0.11364614]], shape=(20000, 2))</code></pre>
</div>
</div>
<div id="cell-63" class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>hdf2seq <span class="op">=</span> HDF2Sequence([<span class="st">'u'</span>,<span class="st">'y'</span>],clm_shift<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>hdf2seq(hdf_files[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[ 0.14557693,  0.23587583],
       [ 0.05459135,  0.23415912],
       [-0.0295274 ,  0.23656251],
       ...,
       [ 0.78831281, -0.1781944 ],
       [ 0.61458185, -0.14866701],
       [ 0.55758711, -0.11364614]], shape=(19999, 2))</code></pre>
</div>
</div>
<div id="cell-64" class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>hdf2seq <span class="op">=</span> HDF2Sequence([<span class="st">'u'</span>,<span class="st">'y'</span>],cached<span class="op">=</span><span class="st">'shared'</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(hdf2seq(hdf_files[<span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 0.27021001  0.24308601]
 [ 0.14557693  0.23587583]
 [ 0.05459135  0.23415912]
 ...
 [ 0.78831281 -0.1781944 ]
 [ 0.61458185 -0.14866701]
 [ 0.55758711 -0.11364614]]</code></pre>
</div>
</div>
<div id="cell-65" class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%timeit</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>hdf2seq(hdf_files[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[ 0.27021001,  0.24308601],
       [ 0.14557693,  0.23587583],
       [ 0.05459135,  0.23415912],
       ...,
       [ 0.78831281, -0.1781944 ],
       [ 0.61458185, -0.14866701],
       [ 0.55758711, -0.11364614]], shape=(20000, 2))</code></pre>
</div>
</div>
<div id="cell-66" class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>hdf2seq <span class="op">=</span> HDF2Sequence([<span class="st">'u'</span>,<span class="st">'y'</span>],cached<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-67" class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%timeit</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>hdf2seq(hdf_files[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[ 0.27021001,  0.24308601],
       [ 0.14557693,  0.23587583],
       [ 0.05459135,  0.23415912],
       ...,
       [ 0.78831281, -0.1781944 ],
       [ 0.61458185, -0.14866701],
       [ 0.55758711, -0.11364614]], shape=(20000, 2))</code></pre>
</div>
</div>
<p>Die Funktion lässt sich mittels Pipeline auf eine Liste von Quellobjekten (hier Pfade) anwenden</p>
<div id="cell-69" class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>hdf2seq <span class="op">=</span> HDF2Sequence([<span class="st">'u'</span>])</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>hdf2seq(hdf_files[<span class="dv">0</span>]).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(20000, 1)</code></pre>
</div>
</div>
<div id="cell-70" class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(HDF2Sequence([<span class="st">'u'</span>,<span class="st">'y'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-71" class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># res_pipe = pipe(hdf_files)</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co"># len(res_pipe), res_pipe[0][0]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="performance-test" class="level4">
<h4 class="anchored" data-anchor-id="performance-test">Performance Test</h4>
<p>Caching stores the arrays for future use at every function call. Very usefull, especially for windows. Should allways be turned. Only explicitly turn it off when there is not enough memory for your data.</p>
<div id="cell-74" class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>tfms<span class="op">=</span>[  [HDF2Sequence([<span class="st">'u'</span>,<span class="st">'y'</span>],cached<span class="op">=</span><span class="va">None</span>)],</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>        [HDF2Sequence([<span class="st">'y'</span>],cached<span class="op">=</span><span class="va">None</span>)]]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>dsrc <span class="op">=</span> Datasets(src_dicts[:<span class="dv">1000</span>],tfms<span class="op">=</span>tfms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-75" class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(dsrc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>1000</code></pre>
</div>
</div>
<div id="cell-76" class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%time</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for x in dsrc:</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-77" class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>tfms<span class="op">=</span>[  [HDF2Sequence([<span class="st">'u'</span>,<span class="st">'y'</span>],cached<span class="op">=</span><span class="va">True</span>,clm_shift<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">2</span>])],</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>        [HDF2Sequence([<span class="st">'y'</span>],cached<span class="op">=</span><span class="va">True</span>)]]</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>dsrc <span class="op">=</span> Datasets(src_dicts[:<span class="dv">1000</span>],tfms<span class="op">=</span>tfms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-78" class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # %%timeit</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for x in dsrc:</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Caching is way faster because every file gets loaded multiple times</p>
</section>
</section>
<section id="extract-scalar-data-from-hdf5-files" class="level3">
<h3 class="anchored" data-anchor-id="extract-scalar-data-from-hdf5-files">Extract Scalar data from hdf5-files</h3>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L451" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hdf2scalars" class="level3">
<h3 class="anchored" data-anchor-id="hdf2scalars">hdf2scalars</h3>
<blockquote class="blockquote">
<pre><code> hdf2scalars (hdf_path, c_names, dataset=None)</code></pre>
</blockquote>
<div id="cell-82" class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hdf2scalars('/mnt/data/sicwell/hdf5/Cycles/ch3/cycle00568.hdf5',['soc','temperature1'],dataset='measurement_00000')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L462" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hdf2scalars-1" class="level3">
<h3 class="anchored" data-anchor-id="hdf2scalars-1">HDF2Scalars</h3>
<blockquote class="blockquote">
<pre><code> HDF2Scalars (clm_names, to_cls=&lt;function noop&gt;)</code></pre>
</blockquote>
<p><em>Delegates (<code>__call__</code>,<code>decode</code>,<code>setup</code>) to (<code>encodes</code>,<code>decodes</code>,<code>setups</code>) if <code>split_idx</code> matches</em></p>
<div id="cell-84" class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HDF2Scalars(['soc','temperature1'])({'path':'/mnt/data/sicwell/hdf5/Cycles/ch3/cycle00568.hdf5','dataset':'measurement_00000'})</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extract-scalar-from-sequence" class="level3">
<h3 class="anchored" data-anchor-id="extract-scalar-from-sequence">Extract Scalar from sequence</h3>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L481" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="scalarsequenceelement" class="level3">
<h3 class="anchored" data-anchor-id="scalarsequenceelement">ScalarSequenceElement</h3>
<blockquote class="blockquote">
<pre><code> ScalarSequenceElement (idx, to_cls=&lt;function noop&gt;)</code></pre>
</blockquote>
<p><em>Delegates (<code>__call__</code>,<code>decode</code>,<code>setup</code>) to (<code>encodes</code>,<code>decodes</code>,<code>setups</code>) if <code>split_idx</code> matches</em></p>
<div id="cell-87" class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>ScalarSequenceElement(<span class="op">-</span><span class="dv">1</span>)(hdf2seq(hdf_files[<span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([0.55758711])</code></pre>
</div>
</div>
</section>
<section id="datatypes-for-sequences-and-scalars" class="level3">
<h3 class="anchored" data-anchor-id="datatypes-for-sequences-and-scalars">2.1 Datatypes for Sequences and Scalars</h3>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L509" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="tensorsequencesoutput" class="level3">
<h3 class="anchored" data-anchor-id="tensorsequencesoutput">TensorSequencesOutput</h3>
<blockquote class="blockquote">
<pre><code> TensorSequencesOutput (x, **kwargs)</code></pre>
</blockquote>
<p><em>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</em></p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L508" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="tensorsequencesinput" class="level3">
<h3 class="anchored" data-anchor-id="tensorsequencesinput">TensorSequencesInput</h3>
<blockquote class="blockquote">
<pre><code> TensorSequencesInput (x, **kwargs)</code></pre>
</blockquote>
<p><em>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</em></p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L490" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="tensorsequences" class="level3">
<h3 class="anchored" data-anchor-id="tensorsequences">TensorSequences</h3>
<blockquote class="blockquote">
<pre><code> TensorSequences (x, **kwargs)</code></pre>
</blockquote>
<p><em>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</em></p>
<div id="cell-92" class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> TensorSequencesInput.from_hdf([<span class="st">'u'</span>])</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(f(hdf_files[<span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>numpy.ndarray</code></pre>
</div>
</div>
<div id="cell-93" class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TensorSequences(np.ones((30,2))).show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="totensorsequencesoutput" class="level3">
<h3 class="anchored" data-anchor-id="totensorsequencesoutput">toTensorSequencesOutput</h3>
<blockquote class="blockquote">
<pre><code> toTensorSequencesOutput (*args, split_idx=None, **kwargs)</code></pre>
</blockquote>
<p><em>Delegates (<code>__call__</code>,<code>decode</code>,<code>setup</code>) to (<code>encodes</code>,<code>decodes</code>,<code>setups</code>) if <code>split_idx</code> matches</em></p>
<hr>
</section>
<section id="totensorsequencesinput" class="level3">
<h3 class="anchored" data-anchor-id="totensorsequencesinput">toTensorSequencesInput</h3>
<blockquote class="blockquote">
<pre><code> toTensorSequencesInput (*args, split_idx=None, **kwargs)</code></pre>
</blockquote>
<p><em>Delegates (<code>__call__</code>,<code>decode</code>,<code>setup</code>) to (<code>encodes</code>,<code>decodes</code>,<code>setups</code>) if <code>split_idx</code> matches</em></p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L526" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="tensorscalarsoutput" class="level3">
<h3 class="anchored" data-anchor-id="tensorscalarsoutput">TensorScalarsOutput</h3>
<blockquote class="blockquote">
<pre><code> TensorScalarsOutput (x, **kwargs)</code></pre>
</blockquote>
<p><em>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</em></p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L525" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="tensorscalarsinput" class="level3">
<h3 class="anchored" data-anchor-id="tensorscalarsinput">TensorScalarsInput</h3>
<blockquote class="blockquote">
<pre><code> TensorScalarsInput (x, **kwargs)</code></pre>
</blockquote>
<p><em>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</em></p>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L518" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="tensorscalars" class="level3">
<h3 class="anchored" data-anchor-id="tensorscalars">TensorScalars</h3>
<blockquote class="blockquote">
<pre><code> TensorScalars (x, **kwargs)</code></pre>
</blockquote>
<p><em>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</em></p>
<p>The tensor subclassing mechanism since pytorch 1.7 keeps the tensor type in tensor operations. Operations with different branches of subclasses of tensors require a implementation of ‘<strong>torch_function</strong>’. Fastai implements ‘TensorBase.register_func’ to mark methods that behave for the given types like the default torch operation.</p>
<p>https://pytorch.org/docs/stable/notes/extending.html#extending-torch</p>
<div id="cell-100" class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> TensorSequencesInput(torch.rand((<span class="dv">10</span>,<span class="dv">10</span>)))</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> TensorSequencesOutput(torch.rand((<span class="dv">10</span>,<span class="dv">10</span>)))</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>torch.nn.functional.mse_loss(x1,x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>TensorSequencesInput(0.1615)</code></pre>
</div>
</div>
</section>
<section id="low-level-with-transforms" class="level3">
<h3 class="anchored" data-anchor-id="low-level-with-transforms">5.1 Low-Level with Transforms</h3>
<div id="cell-102" class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>tfms<span class="op">=</span>[  [HDF2Sequence([<span class="st">'u'</span>]),toTensorSequencesInput],</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>        [HDF2Sequence([<span class="st">'y'</span>]),toTensorSequencesOutput]]</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> Datasets(get_hdf_files(f_path),tfms<span class="op">=</span>tfms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-103" class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ds.dataloaders(bs<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>dls.one_batch()[<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([1, 88000, 1])</code></pre>
</div>
</div>
</section>
</section>
<section id="show-batches-and-results" class="level2">
<h2 class="anchored" data-anchor-id="show-batches-and-results">6. Show Batches and Results</h2>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L535" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="plot_sequence" class="level3">
<h3 class="anchored" data-anchor-id="plot_sequence">plot_sequence</h3>
<blockquote class="blockquote">
<pre><code> plot_sequence (axs, in_sig, targ_sig, out_sig=None, **kwargs)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L548" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="plot_seqs_single_figure" class="level3">
<h3 class="anchored" data-anchor-id="plot_seqs_single_figure">plot_seqs_single_figure</h3>
<blockquote class="blockquote">
<pre><code> plot_seqs_single_figure (n_samples, n_targ, samples, plot_func,
                          outs=None, **kwargs)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/daniel-om-weber/tsfast/blob/master/tsfast/data/core.py#L564" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="plot_seqs_multi_figures" class="level3">
<h3 class="anchored" data-anchor-id="plot_seqs_multi_figures">plot_seqs_multi_figures</h3>
<blockquote class="blockquote">
<pre><code> plot_seqs_multi_figures (n_samples, n_targ, samples, plot_func,
                          outs=None, **kwargs)</code></pre>
</blockquote>
<div id="cell-111" class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>dls.show_batch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_core_files/figure-html/cell-93-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/daniel-om-weber\.github\.io\/tsfast\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/daniel-om-weber/tsfast/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>